Timeline.version="2.3.1";Timeline.ajax_lib_version=SimileAjax.version;Timeline.display_version=Timeline.version+" (with Ajax lib "+Timeline.ajax_lib_version+")";Timeline.strings={};Timeline.HORIZONTAL=0;Timeline.VERTICAL=1;Timeline._defaultTheme=null;Timeline.getDefaultLocale=function(){return Timeline.clientLocale};
Timeline.create=function(a,b,c,d){null==Timeline.timelines&&(Timeline.timelines=[]);var e=Timeline.timelines.length;Timeline.timelines[e]=null;a=new Timeline._Impl(a,b,c,d,e);return Timeline.timelines[e]=a};
Timeline.createBandInfo=function(a){var b="theme"in a?a.theme:Timeline.getDefaultTheme(),c="eventSource"in a?a.eventSource:null,d=new Timeline.LinearEther({centersOn:"date"in a?a.date:new Date,interval:SimileAjax.DateTime.gregorianUnitLengths[a.intervalUnit],pixelsPerInterval:a.intervalPixels,theme:b}),e=new Timeline.GregorianEtherPainter({unit:a.intervalUnit,multiple:"multiple"in a?a.multiple:1,theme:b,align:"align"in a?a.align:void 0}),g={showText:"showEventText"in a?a.showEventText:!0,theme:b};
if("eventPainterParams"in a)for(var f in a.eventPainterParams)g[f]=a.eventPainterParams[f];"trackHeight"in a&&(g.trackHeight=a.trackHeight);"trackGap"in a&&(g.trackGap=a.trackGap);f="overview"in a&&a.overview?"overview":"layout"in a?a.layout:"original";if("eventPainter"in a)g=new a.eventPainter(g);else switch(f){case "overview":g=new Timeline.OverviewEventPainter(g);break;case "detailed":g=new Timeline.DetailedEventPainter(g);break;default:g=new Timeline.OriginalEventPainter(g)}return{width:a.width,
eventSource:c,timeZone:"timeZone"in a?a.timeZone:0,ether:d,etherPainter:e,eventPainter:g,theme:b,zoomIndex:"zoomIndex"in a?a.zoomIndex:0,zoomSteps:"zoomSteps"in a?a.zoomSteps:null}};
Timeline.createHotZoneBandInfo=function(a){var b="theme"in a?a.theme:Timeline.getDefaultTheme(),c="eventSource"in a?a.eventSource:null,d=new Timeline.HotZoneEther({centersOn:"date"in a?a.date:new Date,interval:SimileAjax.DateTime.gregorianUnitLengths[a.intervalUnit],pixelsPerInterval:a.intervalPixels,zones:a.zones,theme:b}),e=new Timeline.HotZoneGregorianEtherPainter({unit:a.intervalUnit,zones:a.zones,theme:b,align:"align"in a?a.align:void 0}),g={showText:"showEventText"in a?a.showEventText:!0,theme:b};
if("eventPainterParams"in a)for(var f in a.eventPainterParams)g[f]=a.eventPainterParams[f];"trackHeight"in a&&(g.trackHeight=a.trackHeight);"trackGap"in a&&(g.trackGap=a.trackGap);f="overview"in a&&a.overview?"overview":"layout"in a?a.layout:"original";if("eventPainter"in a)g=new a.eventPainter(g);else switch(f){case "overview":g=new Timeline.OverviewEventPainter(g);break;case "detailed":g=new Timeline.DetailedEventPainter(g);break;default:g=new Timeline.OriginalEventPainter(g)}return{width:a.width,
eventSource:c,timeZone:"timeZone"in a?a.timeZone:0,ether:d,etherPainter:e,eventPainter:g,theme:b,zoomIndex:"zoomIndex"in a?a.zoomIndex:0,zoomSteps:"zoomSteps"in a?a.zoomSteps:null}};Timeline.getDefaultTheme=function(){null==Timeline._defaultTheme&&(Timeline._defaultTheme=Timeline.ClassicTheme.create(Timeline.getDefaultLocale()));return Timeline._defaultTheme};Timeline.setDefaultTheme=function(a){Timeline._defaultTheme=a};
Timeline.loadXML=function(a,b){SimileAjax.XmlHttp.get(a,function(b){alert("Failed to load data xml from "+a+"\n"+b)},function(c){var d=c.responseXML;!d.documentElement&&c.responseStream&&d.load(c.responseStream);b(d,a)})};Timeline.loadJSON=function(a,b){SimileAjax.XmlHttp.get(a,function(b){alert("Failed to load json data from "+a+"\n"+b)},function(c){b(eval("("+c.responseText+")"),a)})};Timeline.getTimelineFromID=function(a){return Timeline.timelines[a]};
Timeline.writeVersion=function(a){document.getElementById(a).innerHTML=this.display_version};
Timeline._Impl=function(a,b,c,d,e){SimileAjax.WindowManager.initialize();this._containerDiv=a;this._bandInfos=b;this._orientation=null==c?Timeline.HORIZONTAL:c;this._unit=null!=d?d:SimileAjax.NativeDateUnit;this._starting=!0;this._autoResizing=!1;this.autoWidth=b&&b[0]&&b[0].theme&&b[0].theme.autoWidth;this.autoWidthAnimationTime=b&&b[0]&&b[0].theme&&b[0].theme.autoWidthAnimationTime;this.timelineID=e;this.timeline_start=b&&b[0]&&b[0].theme&&b[0].theme.timeline_start;this.timeline_stop=b&&b[0]&&b[0].theme&&
b[0].theme.timeline_stop;this.timeline_at_stop=this.timeline_at_start=!1;this._initialize()};Timeline._Impl.prototype.dispose=function(){for(var a=0;a<this._bands.length;a++)this._bands[a].dispose();this._bandInfos=this._bands=null;this._containerDiv.innerHTML="";Timeline.timelines[this.timelineID]=null};Timeline._Impl.prototype.getBandCount=function(){return this._bands.length};Timeline._Impl.prototype.getBand=function(a){return this._bands[a]};
Timeline._Impl.prototype.finishedEventLoading=function(){this._autoWidthCheck(!0);this._starting=!1};Timeline._Impl.prototype.layout=function(){this._autoWidthCheck(!0);this._distributeWidths()};Timeline._Impl.prototype.paint=function(){for(var a=0;a<this._bands.length;a++)this._bands[a].paint()};Timeline._Impl.prototype.getDocument=function(){return this._containerDiv.ownerDocument};Timeline._Impl.prototype.addDiv=function(a){this._containerDiv.appendChild(a)};
Timeline._Impl.prototype.removeDiv=function(a){this._containerDiv.removeChild(a)};Timeline._Impl.prototype.isHorizontal=function(){return this._orientation==Timeline.HORIZONTAL};Timeline._Impl.prototype.isVertical=function(){return this._orientation==Timeline.VERTICAL};Timeline._Impl.prototype.getPixelLength=function(){return this._orientation==Timeline.HORIZONTAL?this._containerDiv.offsetWidth:this._containerDiv.offsetHeight};
Timeline._Impl.prototype.getPixelWidth=function(){return this._orientation==Timeline.VERTICAL?this._containerDiv.offsetWidth:this._containerDiv.offsetHeight};Timeline._Impl.prototype.getUnit=function(){return this._unit};Timeline._Impl.prototype.getWidthStyle=function(){return this._orientation==Timeline.HORIZONTAL?"height":"width"};
Timeline._Impl.prototype.loadXML=function(a,b){var c=this,d=function(b){alert("Failed to load data xml from "+a+"\n"+b);c.hideLoadingMessage()},e=function(d){try{var f=d.responseXML;!f.documentElement&&d.responseStream&&f.load(d.responseStream);b(f,a)}finally{c.hideLoadingMessage()}};this.showLoadingMessage();window.setTimeout(function(){SimileAjax.XmlHttp.get(a,d,e)},0)};
Timeline._Impl.prototype.loadJSON=function(a,b){var c=this,d=function(b){alert("Failed to load json data from "+a+"\n"+b);c.hideLoadingMessage()},e=function(d){try{b(eval("("+d.responseText+")"),a)}finally{c.hideLoadingMessage()}};this.showLoadingMessage();window.setTimeout(function(){SimileAjax.XmlHttp.get(a,d,e)},0)};Timeline._Impl.prototype._autoWidthScrollListener=function(a){a.getTimeline()._autoWidthCheck(!1)};
Timeline._Impl.prototype._autoWidthCheck=function(a){var b=this,c=b._starting,d=0;if(b.autoWidth){var d=0,e=b.getPixelWidth();if(!b._autoResizing){for(var g=0;g<b._bands.length;g++)b._bands[g].checkAutoWidth(),d+=b._bandInfos[g].width;if(d>e||a)a=b.getWidthStyle(),c?b._containerDiv.style[a]=d+"px":(b._autoResizing=!0,c={},c[a]=d+"px",SimileAjax.jQuery(b._containerDiv).animate(c,b.autoWidthAnimationTime,"linear",function(){b._autoResizing=!1})),b._distributeWidths()}}};
Timeline._Impl.prototype._initialize=function(){var a=this._containerDiv,b=a.ownerDocument;a.className=a.className.split(" ").concat("timeline-container").join(" ");var c=this.isHorizontal()?"horizontal":"vertical";for(a.className+=" timeline-"+c;a.firstChild;)a.removeChild(a.firstChild);c=SimileAjax.Graphics.createTranslucentImage(Timeline.urlPrefix+(this.isHorizontal()?"images/copyright-vertical.png":"images/copyright.png"));c.className="timeline-copyright";c.title="Timeline copyright SIMILE - www.code.google.com/p/simile-widgets/";
SimileAjax.DOM.registerEvent(c,"click",function(){window.location="http://code.google.com/p/simile-widgets/"});a.appendChild(c);this._bands=[];for(c=0;c<this._bandInfos.length;c++){var d=new Timeline._Band(this,this._bandInfos[c],c);this._bands.push(d)}this._distributeWidths();for(c=0;c<this._bandInfos.length;c++)d=this._bandInfos[c],"syncWith"in d&&this._bands[c].setSyncWithBand(this._bands[d.syncWith],"highlight"in d?d.highlight:!1);if(this.autoWidth)for(c=0;c<this._bands.length;c++)this._bands[c].addOnScrollListener(this._autoWidthScrollListener);
var e=SimileAjax.Graphics.createMessageBubble(b);e.containerDiv.className="timeline-message-container";a.appendChild(e.containerDiv);e.contentDiv.className="timeline-message";e.contentDiv.innerHTML="<img src='"+Timeline.urlPrefix+"images/progress-running.gif' /> Loading...";this.showLoadingMessage=function(){e.containerDiv.style.display="block"};this.hideLoadingMessage=function(){e.containerDiv.style.display="none"}};
Timeline._Impl.prototype._distributeWidths=function(){for(var a=this.getPixelLength(),b=this.getPixelWidth(),c=0,d=0;d<this._bands.length;d++){var e=this._bands[d],g=this._bandInfos[d].width;if("string"==typeof g){var f=g.indexOf("%");0<f?(g=parseInt(g.substr(0,f)),g=Math.round(g*b/100)):g=parseInt(g)}e.setBandShiftAndWidth(c,g);e.setViewLength(a);c+=g}};
Timeline._Impl.prototype.shiftOK=function(a,b){var c=0<b,d=0>b;if(c&&null==this.timeline_start||d&&null==this.timeline_stop||0==b)return!0;for(var e=!1,g=0;g<this._bands.length&&!e;g++)e=this._bands[g].busy();if(e)return!0;if(c&&this.timeline_at_start||d&&this.timeline_at_stop)return!1;d=!1;for(g=0;g<this._bands.length&&!d;g++)d=this._bands[g],d=c?(g==a?d.getMinVisibleDateAfterDelta(b):d.getMinVisibleDate())>=this.timeline_start:(g==a?d.getMaxVisibleDateAfterDelta(b):d.getMaxVisibleDate())<=this.timeline_stop;
c?(this.timeline_at_start=!d,this.timeline_at_stop=!1):(this.timeline_at_stop=!d,this.timeline_at_start=!1);return d};Timeline._Impl.prototype.zoom=function(a,b,c,d){var e=null,g=/^timeline-band-([0-9]+)$/.exec(d.id);g&&(e=parseInt(g[1]));null!=e&&this._bands[e].zoom(a,b,c,d);this.paint()};Timeline.GregorianDateLabeller=function(a,b){this._locale=a;this._timeZone=b};Timeline.GregorianDateLabeller.monthNames=[];Timeline.GregorianDateLabeller.dayNames=[];
Timeline.GregorianDateLabeller.labelIntervalFunctions=[];Timeline.GregorianDateLabeller.monthNames.en="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");Timeline.GregorianDateLabeller.dayNames.en="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" ");Timeline.GregorianDateLabeller.getMonthName=function(a,b){return Timeline.GregorianDateLabeller.monthNames[b][a]};
Timeline.GregorianDateLabeller.prototype.labelInterval=function(a,b){var c=Timeline.GregorianDateLabeller.labelIntervalFunctions[this._locale];null==c&&(c=Timeline.GregorianDateLabeller.prototype.defaultLabelInterval);return c.call(this,a,b)};Timeline.GregorianDateLabeller.prototype.labelPrecise=function(a){return SimileAjax.DateTime.removeTimeZoneOffset(a,this._timeZone).toUTCString()};
Timeline.GregorianDateLabeller.prototype.defaultLabelInterval=function(a,b){var c,d=!1;a=SimileAjax.DateTime.removeTimeZoneOffset(a,this._timeZone);switch(b){case SimileAjax.DateTime.MILLISECOND:c=a.getUTCMilliseconds();break;case SimileAjax.DateTime.SECOND:c=a.getUTCSeconds();break;case SimileAjax.DateTime.MINUTE:c=a.getUTCMinutes();0==c&&(c=a.getUTCHours()+":00",d=!0);break;case SimileAjax.DateTime.HOUR:c=a.getUTCHours()+"hr";break;case SimileAjax.DateTime.DAY:c=Timeline.GregorianDateLabeller.getMonthName(a.getUTCMonth(),
this._locale)+" "+a.getUTCDate();break;case SimileAjax.DateTime.WEEK:c=Timeline.GregorianDateLabeller.getMonthName(a.getUTCMonth(),this._locale)+" "+a.getUTCDate();break;case SimileAjax.DateTime.MONTH:if(c=a.getUTCMonth(),0!=c){c=Timeline.GregorianDateLabeller.getMonthName(c,this._locale);break}case SimileAjax.DateTime.YEAR:case SimileAjax.DateTime.DECADE:case SimileAjax.DateTime.CENTURY:case SimileAjax.DateTime.MILLENNIUM:d=a.getUTCFullYear();c=0<d?a.getUTCFullYear():1-d+"BC";d=b==SimileAjax.DateTime.MONTH||
b==SimileAjax.DateTime.DECADE&&0==d%100||b==SimileAjax.DateTime.CENTURY&&0==d%1E3;break;default:c=a.toUTCString()}return{text:c,emphasized:d}};
Timeline._Band=function(a,b,c){a.autoWidth&&"string"==typeof b.width&&(b.width=-1<b.width.indexOf("%")?0:parseInt(b.width));this._timeline=a;this._bandInfo=b;this._index=c;this._locale="locale"in b?b.locale:Timeline.getDefaultLocale();this._timeZone="timeZone"in b?b.timeZone:0;this._labeller="labeller"in b?b.labeller:"createLabeller"in a.getUnit()?a.getUnit().createLabeller(this._locale,this._timeZone):new Timeline.GregorianDateLabeller(this._locale,this._timeZone);this._theme=b.theme;this._zoomIndex=
"zoomIndex"in b?b.zoomIndex:0;this._zoomSteps="zoomSteps"in b?b.zoomSteps:null;this._changing=this._dragging=!1;this._scrollSpeed=this._originalScrollSpeed=5;this._onScrollListeners=[];var d=this;this._syncWithBand=null;this._syncWithBandHandler=function(){d._onHighlightBandScroll()};this._selectorListener=function(){d._onHighlightBandScroll()};var e=this._timeline.getDocument().createElement("div");e.className="timeline-band-input";this._timeline.addDiv(e);this._keyboardInput=document.createElement("input");
this._keyboardInput.type="text";e.appendChild(this._keyboardInput);SimileAjax.DOM.registerEventWithObject(this._keyboardInput,"keydown",this,"_onKeyDown");SimileAjax.DOM.registerEventWithObject(this._keyboardInput,"keyup",this,"_onKeyUp");this._div=this._timeline.getDocument().createElement("div");this._div.id="timeline-band-"+c;this._div.className="timeline-band timeline-band-"+c;this._timeline.addDiv(this._div);SimileAjax.DOM.registerEventWithObject(this._div,"mousedown",this,"_onMouseDown");SimileAjax.DOM.registerEventWithObject(this._div,
"mousemove",this,"_onMouseMove");SimileAjax.DOM.registerEventWithObject(this._div,"mouseup",this,"_onMouseUp");SimileAjax.DOM.registerEventWithObject(this._div,"mouseout",this,"_onMouseOut");SimileAjax.DOM.registerEventWithObject(this._div,"dblclick",this,"_onDblClick");c=null!=this._theme?this._theme.mouseWheel:"scroll";if("zoom"===c||"scroll"===c||this._zoomSteps)SimileAjax.Platform.browser.isFirefox?SimileAjax.DOM.registerEventWithObject(this._div,"DOMMouseScroll",this,"_onMouseScroll"):SimileAjax.DOM.registerEventWithObject(this._div,
"mousewheel",this,"_onMouseScroll");this._innerDiv=this._timeline.getDocument().createElement("div");this._innerDiv.className="timeline-band-inner";this._div.appendChild(this._innerDiv);this._ether=b.ether;b.ether.initialize(this,a);this._etherPainter=b.etherPainter;b.etherPainter.initialize(this,a);if(this._eventSource=b.eventSource)this._eventListener={onAddMany:function(){d._onAddMany()},onClear:function(){d._onClear()}},this._eventSource.addListener(this._eventListener);this._eventPainter=b.eventPainter;
this._eventTrackIncrement=this._eventTracksNeeded=0;b.eventPainter.initialize(this,a);this._decorators="decorators"in b?b.decorators:[];for(b=0;b<this._decorators.length;b++)this._decorators[b].initialize(this,a)};Timeline._Band.SCROLL_MULTIPLES=5;
Timeline._Band.prototype.dispose=function(){this.closeBubble();this._eventSource&&(this._eventSource.removeListener(this._eventListener),this._eventSource=this._eventListener=null);this._keyboardInput=this._innerDiv=this._div=this._selectorListener=this._syncWithBandHandler=this._onScrollListeners=this._decorators=this._eventPainter=this._etherPainter=this._ether=this._labeller=this._bandInfo=this._timeline=null};Timeline._Band.prototype.addOnScrollListener=function(a){this._onScrollListeners.push(a)};
Timeline._Band.prototype.removeOnScrollListener=function(a){for(var b=0;b<this._onScrollListeners.length;b++)if(this._onScrollListeners[b]==a){this._onScrollListeners.splice(b,1);break}};Timeline._Band.prototype.setSyncWithBand=function(a,b){this._syncWithBand&&this._syncWithBand.removeOnScrollListener(this._syncWithBandHandler);this._syncWithBand=a;this._syncWithBand.addOnScrollListener(this._syncWithBandHandler);this._highlight=b;this._positionHighlight()};Timeline._Band.prototype.getLocale=function(){return this._locale};
Timeline._Band.prototype.getTimeZone=function(){return this._timeZone};Timeline._Band.prototype.getLabeller=function(){return this._labeller};Timeline._Band.prototype.getIndex=function(){return this._index};Timeline._Band.prototype.getEther=function(){return this._ether};Timeline._Band.prototype.getEtherPainter=function(){return this._etherPainter};Timeline._Band.prototype.getEventSource=function(){return this._eventSource};Timeline._Band.prototype.getEventPainter=function(){return this._eventPainter};
Timeline._Band.prototype.getTimeline=function(){return this._timeline};Timeline._Band.prototype.updateEventTrackInfo=function(a,b){this._eventTrackIncrement=b;a>this._eventTracksNeeded&&(this._eventTracksNeeded=a)};
Timeline._Band.prototype.checkAutoWidth=function(){if(this._timeline.autoWidth){var a="overview"==this._eventPainter.getType(),b=Math.ceil((this._eventTracksNeeded+(a?this._theme.event.overviewTrack.autoWidthMargin:this._theme.event.track.autoWidthMargin))*this._eventTrackIncrement),b=b+(a?this._theme.event.overviewTrack.offset:this._theme.event.track.offset),a=this._bandInfo;b!=a.width&&(a.width=b)}};Timeline._Band.prototype.layout=function(){this.paint()};
Timeline._Band.prototype.paint=function(){this._etherPainter.paint();this._paintDecorators();this._paintEvents()};Timeline._Band.prototype.softLayout=function(){this.softPaint()};Timeline._Band.prototype.softPaint=function(){this._etherPainter.softPaint();this._softPaintDecorators();this._softPaintEvents()};
Timeline._Band.prototype.setBandShiftAndWidth=function(a,b){var c=this._keyboardInput.parentNode,d=a+Math.floor(b/2);this._timeline.isHorizontal()?(this._div.style.top=a+"px",this._div.style.height=b+"px",c.style.top=d+"px",c.style.left="-1em"):(this._div.style.left=a+"px",this._div.style.width=b+"px",c.style.left=d+"px",c.style.top="-1em")};Timeline._Band.prototype.getViewWidth=function(){return this._timeline.isHorizontal()?this._div.offsetHeight:this._div.offsetWidth};
Timeline._Band.prototype.setViewLength=function(a){this._viewLength=a;this._recenterDiv();this._onChanging()};Timeline._Band.prototype.getViewLength=function(){return this._viewLength};Timeline._Band.prototype.getTotalViewLength=function(){return Timeline._Band.SCROLL_MULTIPLES*this._viewLength};Timeline._Band.prototype.getViewOffset=function(){return this._viewOffset};Timeline._Band.prototype.getMinDate=function(){return this._ether.pixelOffsetToDate(this._viewOffset)};
Timeline._Band.prototype.getMaxDate=function(){return this._ether.pixelOffsetToDate(this._viewOffset+Timeline._Band.SCROLL_MULTIPLES*this._viewLength)};Timeline._Band.prototype.getMinVisibleDate=function(){return this._ether.pixelOffsetToDate(0)};Timeline._Band.prototype.getMinVisibleDateAfterDelta=function(a){return this._ether.pixelOffsetToDate(a)};Timeline._Band.prototype.getMaxVisibleDate=function(){return this._ether.pixelOffsetToDate(this._viewLength)};
Timeline._Band.prototype.getMaxVisibleDateAfterDelta=function(a){return this._ether.pixelOffsetToDate(this._viewLength+a)};Timeline._Band.prototype.getCenterVisibleDate=function(){return this._ether.pixelOffsetToDate(this._viewLength/2)};Timeline._Band.prototype.setMinVisibleDate=function(a){this._changing||this._moveEther(Math.round(-this._ether.dateToPixelOffset(a)))};Timeline._Band.prototype.setMaxVisibleDate=function(a){this._changing||this._moveEther(Math.round(this._viewLength-this._ether.dateToPixelOffset(a)))};
Timeline._Band.prototype.setCenterVisibleDate=function(a){this._changing||this._moveEther(Math.round(this._viewLength/2-this._ether.dateToPixelOffset(a)))};Timeline._Band.prototype.dateToPixelOffset=function(a){return this._ether.dateToPixelOffset(a)-this._viewOffset};Timeline._Band.prototype.pixelOffsetToDate=function(a){return this._ether.pixelOffsetToDate(a+this._viewOffset)};
Timeline._Band.prototype.createLayerDiv=function(a,b){var c=this._timeline.getDocument().createElement("div");c.className="timeline-band-layer"+("string"==typeof b?" "+b:"");c.style.zIndex=a;this._innerDiv.appendChild(c);var d=this._timeline.getDocument().createElement("div");d.className="timeline-band-layer-inner";d.style.cursor=SimileAjax.Platform.browser.isIE?"move":"-moz-grab";c.appendChild(d);return d};Timeline._Band.prototype.removeLayerDiv=function(a){this._innerDiv.removeChild(a.parentNode)};
Timeline._Band.prototype.scrollToCenter=function(a,b){var c=this._ether.dateToPixelOffset(a);c<-this._viewLength/2?this.setCenterVisibleDate(this.pixelOffsetToDate(c+this._viewLength)):c>3*this._viewLength/2&&this.setCenterVisibleDate(this.pixelOffsetToDate(c-this._viewLength));this._autoScroll(Math.round(this._viewLength/2-this._ether.dateToPixelOffset(a)),b)};
Timeline._Band.prototype.showBubbleForEvent=function(a){var b=this.getEventSource().getEvent(a);if(b){var c=this;this.scrollToCenter(b.getStart(),function(){c._eventPainter.showBubble(b)})}};Timeline._Band.prototype.zoom=function(a,b){if(this._zoomSteps){b+=this._viewOffset;var c=this._ether.pixelOffsetToDate(b),d=this._ether.zoom(a);this._etherPainter.zoom(d);this._moveEther(Math.round(-this._ether.dateToPixelOffset(c)));this._moveEther(b)}};
Timeline._Band.prototype._onMouseDown=function(a,b){this.closeBubble();this._dragging=!0;this._dragX=b.clientX;this._dragY=b.clientY};Timeline._Band.prototype._onMouseMove=function(a,b){if(this._dragging){var c=b.clientX-this._dragX,d=b.clientY-this._dragY;this._dragX=b.clientX;this._dragY=b.clientY;this._moveEther(this._timeline.isHorizontal()?c:d);this._positionHighlight()}};Timeline._Band.prototype._onMouseUp=function(){this._dragging=!1;this._keyboardInput.focus()};
Timeline._Band.prototype._onMouseOut=function(a,b){var c=SimileAjax.DOM.getEventRelativeCoordinates(b,a);c.x+=this._viewOffset;if(0>c.x||c.x>a.offsetWidth||0>c.y||c.y>a.offsetHeight)this._dragging=!1};
Timeline._Band.prototype._onMouseScroll=function(a,b){var c=new Date,c=c.getTime();if(!this._lastScrollTime||50<c-this._lastScrollTime){this._lastScrollTime=c;c=0;b.wheelDelta?c=b.wheelDelta/120:b.detail&&(c=-b.detail/3);var d=this._theme.mouseWheel;if(this._zoomSteps||"zoom"===d){if(d=SimileAjax.DOM.getEventRelativeCoordinates(b,a),0!=c){var e;0<c&&(e=!0);0>c&&(e=!1);this._timeline.zoom(e,d.x,d.y,a)}}else"scroll"===d&&this._moveEther(50*(0>c?-1:1))}b.stopPropagation&&b.stopPropagation();b.cancelBubble=
!0;b.preventDefault&&b.preventDefault();b.returnValue=!1};Timeline._Band.prototype._onDblClick=function(a,b){var c=SimileAjax.DOM.getEventRelativeCoordinates(b,a).x-(this._viewLength/2-this._viewOffset);this._autoScroll(-c)};
Timeline._Band.prototype._onKeyDown=function(a,b){if(!this._dragging){switch(b.keyCode){case 27:break;case 37:case 38:this._scrollSpeed=Math.min(50,Math.abs(1.05*this._scrollSpeed));this._moveEther(this._scrollSpeed);break;case 39:case 40:this._scrollSpeed=-Math.min(50,Math.abs(1.05*this._scrollSpeed));this._moveEther(this._scrollSpeed);break;default:return!0}this.closeBubble();SimileAjax.DOM.cancelEvent(b);return!1}return!0};
Timeline._Band.prototype._onKeyUp=function(a,b){if(!this._dragging){this._scrollSpeed=this._originalScrollSpeed;switch(b.keyCode){case 35:this.setCenterVisibleDate(this._eventSource.getLatestDate());break;case 36:this.setCenterVisibleDate(this._eventSource.getEarliestDate());break;case 33:this._autoScroll(this._timeline.getPixelLength());break;case 34:this._autoScroll(-this._timeline.getPixelLength());break;default:return!0}this.closeBubble();SimileAjax.DOM.cancelEvent(b);return!1}return!0};
Timeline._Band.prototype._autoScroll=function(a,b){var c=this;SimileAjax.Graphics.createAnimation(function(a,b){c._moveEther(b)},0,a,1E3,b).run()};
Timeline._Band.prototype._moveEther=function(a){this.closeBubble();this._timeline.shiftOK(this._index,a)&&(this._viewOffset+=a,this._ether.shiftPixels(-a),this._timeline.isHorizontal()?this._div.style.left=this._viewOffset+"px":this._div.style.top=this._viewOffset+"px",this._viewOffset>0.5*-this._viewLength||this._viewOffset<-this._viewLength*(Timeline._Band.SCROLL_MULTIPLES-1.5)?this._recenterDiv():this.softLayout(),this._onChanging())};
Timeline._Band.prototype._onChanging=function(){this._changing=!0;this._fireOnScroll();this._setSyncWithBandDate();this._changing=!1};Timeline._Band.prototype.busy=function(){return this._changing};Timeline._Band.prototype._fireOnScroll=function(){for(var a=0;a<this._onScrollListeners.length;a++)this._onScrollListeners[a](this)};Timeline._Band.prototype._setSyncWithBandDate=function(){if(this._syncWithBand){var a=this._ether.pixelOffsetToDate(this.getViewLength()/2);this._syncWithBand.setCenterVisibleDate(a)}};
Timeline._Band.prototype._onHighlightBandScroll=function(){if(this._syncWithBand){var a=this._syncWithBand.getCenterVisibleDate(),a=this._ether.dateToPixelOffset(a);this._moveEther(Math.round(this._viewLength/2-a));this._highlight&&this._etherPainter.setHighlight(this._syncWithBand.getMinVisibleDate(),this._syncWithBand.getMaxVisibleDate())}};Timeline._Band.prototype._onAddMany=function(){this._paintEvents()};Timeline._Band.prototype._onClear=function(){this._paintEvents()};
Timeline._Band.prototype._positionHighlight=function(){if(this._syncWithBand){var a=this._syncWithBand.getMinVisibleDate(),b=this._syncWithBand.getMaxVisibleDate();this._highlight&&this._etherPainter.setHighlight(a,b)}};
Timeline._Band.prototype._recenterDiv=function(){this._viewOffset=-this._viewLength*(Timeline._Band.SCROLL_MULTIPLES-1)/2;this._timeline.isHorizontal()?(this._div.style.left=this._viewOffset+"px",this._div.style.width=Timeline._Band.SCROLL_MULTIPLES*this._viewLength+"px"):(this._div.style.top=this._viewOffset+"px",this._div.style.height=Timeline._Band.SCROLL_MULTIPLES*this._viewLength+"px");this.layout()};Timeline._Band.prototype._paintEvents=function(){this._eventPainter.paint()};
Timeline._Band.prototype._softPaintEvents=function(){this._eventPainter.softPaint()};Timeline._Band.prototype._paintDecorators=function(){for(var a=0;a<this._decorators.length;a++)this._decorators[a].paint()};Timeline._Band.prototype._softPaintDecorators=function(){for(var a=0;a<this._decorators.length;a++)this._decorators[a].softPaint()};Timeline._Band.prototype.closeBubble=function(){SimileAjax.WindowManager.cancelPopups()};Timeline.ClassicTheme={};Timeline.ClassicTheme.implementations=[];
Timeline.ClassicTheme.create=function(a){null==a&&(a=Timeline.getDefaultLocale());a=Timeline.ClassicTheme.implementations[a];null==a&&(a=Timeline.ClassicTheme._Impl);return new a};
Timeline.ClassicTheme._Impl=function(){this.firstDayOfWeek=0;this.autoWidth=!1;this.autoWidthAnimationTime=500;this.timeline_stop=this.timeline_start=null;this.ether={backgroundColors:[],highlightOpacity:50,interval:{line:{show:!0,opacity:25},weekend:{opacity:30},marker:{hAlign:"Bottom",vAlign:"Right"}}};this.event={track:{height:10,gap:2,offset:2,autoWidthMargin:1.5},overviewTrack:{offset:20,tickHeight:6,height:2,gap:1,autoWidthMargin:5},tape:{height:4},instant:{icon:Timeline.urlPrefix+"images/dull-blue-circle.png",
iconWidth:10,iconHeight:10,impreciseOpacity:20,impreciseIconMargin:3},duration:{impreciseOpacity:20},label:{backgroundOpacity:50,offsetFromLine:3},highlightColors:["#FFFF00","#FFC000","#FF0000","#0000FF"],highlightLabelBackground:!1,bubble:{width:250,maxHeight:0,titleStyler:function(a){a.className="timeline-event-bubble-title"},bodyStyler:function(a){a.className="timeline-event-bubble-body"},imageStyler:function(a){a.className="timeline-event-bubble-image"},wikiStyler:function(a){a.className="timeline-event-bubble-wiki"},
timeStyler:function(a){a.className="timeline-event-bubble-time"}}};this.mouseWheel="scroll"};Timeline.LinearEther=function(a){this._params=a;this._interval=a.interval;this._pixelsPerInterval=a.pixelsPerInterval};
Timeline.LinearEther.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._unit=b.getUnit();"startsOn"in this._params?this._start=this._unit.parseFromObject(this._params.startsOn):"endsOn"in this._params?(this._start=this._unit.parseFromObject(this._params.endsOn),this.shiftPixels(-this._timeline.getPixelLength())):(this._start="centersOn"in this._params?this._unit.parseFromObject(this._params.centersOn):this._unit.makeDefaultValue(),this.shiftPixels(-this._timeline.getPixelLength()/
2))};Timeline.LinearEther.prototype.setDate=function(a){this._start=this._unit.cloneValue(a)};Timeline.LinearEther.prototype.shiftPixels=function(a){this._start=this._unit.change(this._start,this._interval*a/this._pixelsPerInterval)};Timeline.LinearEther.prototype.dateToPixelOffset=function(a){a=this._unit.compare(a,this._start);return this._pixelsPerInterval*a/this._interval};Timeline.LinearEther.prototype.pixelOffsetToDate=function(a){return this._unit.change(this._start,a*this._interval/this._pixelsPerInterval)};
Timeline.LinearEther.prototype.zoom=function(a){var b=0,c=b=this._band._zoomIndex;a&&0<b&&(c=b-1);!a&&b<this._band._zoomSteps.length-1&&(c=b+1);this._band._zoomIndex=c;this._interval=SimileAjax.DateTime.gregorianUnitLengths[this._band._zoomSteps[c].unit];this._pixelsPerInterval=this._band._zoomSteps[c].pixelsPerInterval;return b=this._band._zoomSteps[c].unit-this._band._zoomSteps[b].unit};
Timeline.HotZoneEther=function(a){this._params=a;this._interval=a.interval;this._pixelsPerInterval=a.pixelsPerInterval;this._theme=a.theme};
Timeline.HotZoneEther.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._unit=b.getUnit();this._zones=[{startTime:Number.NEGATIVE_INFINITY,endTime:Number.POSITIVE_INFINITY,magnify:1}];for(var c=this._params,d=0;d<c.zones.length;d++)for(var e=c.zones[d],g=this._unit.parseFromObject(e.start),f=this._unit.parseFromObject(e.end),h=0;h<this._zones.length&&0<this._unit.compare(f,g);h++){var j=this._zones[h];0>this._unit.compare(g,j.endTime)&&(0<this._unit.compare(g,j.startTime)&&(this._zones.splice(h,
0,{startTime:j.startTime,endTime:g,magnify:j.magnify}),h++,j.startTime=g),0>this._unit.compare(f,j.endTime)?(this._zones.splice(h,0,{startTime:g,endTime:f,magnify:e.magnify*j.magnify}),h++,g=j.startTime=f):(j.magnify*=e.magnify,g=j.endTime))}"startsOn"in this._params?this._start=this._unit.parseFromObject(this._params.startsOn):"endsOn"in this._params?(this._start=this._unit.parseFromObject(this._params.endsOn),this.shiftPixels(-this._timeline.getPixelLength())):(this._start="centersOn"in this._params?
this._unit.parseFromObject(this._params.centersOn):this._unit.makeDefaultValue(),this.shiftPixels(-this._timeline.getPixelLength()/2))};Timeline.HotZoneEther.prototype.setDate=function(a){this._start=this._unit.cloneValue(a)};Timeline.HotZoneEther.prototype.shiftPixels=function(a){this._start=this.pixelOffsetToDate(a)};Timeline.HotZoneEther.prototype.dateToPixelOffset=function(a){return this._dateDiffToPixelOffset(this._start,a)};
Timeline.HotZoneEther.prototype.pixelOffsetToDate=function(a){return this._pixelOffsetToDate(a,this._start)};Timeline.HotZoneEther.prototype.zoom=function(a){var b=0,c=b=this._band._zoomIndex;a&&0<b&&(c=b-1);!a&&b<this._band._zoomSteps.length-1&&(c=b+1);this._band._zoomIndex=c;this._interval=SimileAjax.DateTime.gregorianUnitLengths[this._band._zoomSteps[c].unit];this._pixelsPerInterval=this._band._zoomSteps[c].pixelsPerInterval;return b=this._band._zoomSteps[c].unit-this._band._zoomSteps[b].unit};
Timeline.HotZoneEther.prototype._dateDiffToPixelOffset=function(a,b){var c=this._getScale(),d=a,e=0;if(0>this._unit.compare(d,b)){for(var g=0;g<this._zones.length&&!(0>this._unit.compare(d,this._zones[g].endTime));)g++;for(;0>this._unit.compare(d,b);){var f=this._zones[g],h=this._unit.earlier(b,f.endTime),e=e+this._unit.compare(h,d)/(c/f.magnify),d=h;g++}}else{for(g=this._zones.length-1;0<=g&&!(0<this._unit.compare(d,this._zones[g].startTime));)g--;for(;0<this._unit.compare(d,b);)f=this._zones[g],
h=this._unit.later(b,f.startTime),e+=this._unit.compare(h,d)/(c/f.magnify),d=h,g--}return e};
Timeline.HotZoneEther.prototype._pixelOffsetToDate=function(a,b){var c=this._getScale(),d=b;if(0<a){for(var e=0;e<this._zones.length&&!(0>this._unit.compare(d,this._zones[e].endTime));)e++;for(;0<a;){var g=this._zones[e],f=c/g.magnify;if(g.endTime==Number.POSITIVE_INFINITY)d=this._unit.change(d,a*f),a=0;else{var h=this._unit.compare(g.endTime,d)/f;h>a?(d=this._unit.change(d,a*f),a=0):(d=g.endTime,a-=h)}e++}}else{for(e=this._zones.length-1;0<=e&&!(0<this._unit.compare(d,this._zones[e].startTime));)e--;
for(a=-a;0<a;)g=this._zones[e],f=c/g.magnify,g.startTime==Number.NEGATIVE_INFINITY?(d=this._unit.change(d,-a*f),a=0):(h=this._unit.compare(d,g.startTime)/f,h>a?(d=this._unit.change(d,-a*f),a=0):(d=g.startTime,a-=h)),e--}return d};Timeline.HotZoneEther.prototype._getScale=function(){return this._interval/this._pixelsPerInterval};Timeline.GregorianEtherPainter=function(a){this._params=a;this._theme=a.theme;this._unit=a.unit;this._multiple="multiple"in a?a.multiple:1};
Timeline.GregorianEtherPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._backgroundLayer=a.createLayerDiv(0);this._backgroundLayer.setAttribute("name","ether-background");this._backgroundLayer.className="timeline-ether-bg";this._lineLayer=this._markerLayer=null;var c="align"in this._params&&void 0!=this._params.align?this._params.align:this._theme.ether.interval.marker[b.isHorizontal()?"hAlign":"vAlign"];this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,
this._band,this._theme,c,"showLine"in this._params?this._params.showLine:this._theme.ether.interval.line.show);this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)};Timeline.GregorianEtherPainter.prototype.setHighlight=function(a,b){this._highlight.position(a,b)};
Timeline.GregorianEtherPainter.prototype.paint=function(){this._markerLayer&&this._band.removeLayerDiv(this._markerLayer);this._markerLayer=this._band.createLayerDiv(100);this._markerLayer.setAttribute("name","ether-markers");this._markerLayer.style.display="none";this._lineLayer&&this._band.removeLayerDiv(this._lineLayer);this._lineLayer=this._band.createLayerDiv(1);this._lineLayer.setAttribute("name","ether-lines");this._lineLayer.style.display="none";var a=this._band.getMinDate(),b=this._band.getMaxDate(),
c=this._band.getTimeZone(),d=this._band.getLabeller();for(SimileAjax.DateTime.roundDownToInterval(a,this._unit,c,this._multiple,this._theme.firstDayOfWeek);a.getTime()<b.getTime();){this._intervalMarkerLayout.createIntervalMarker(a,d,this._unit,this._markerLayer,this._lineLayer);for(var c=a,e=0;e<this._multiple;e++)SimileAjax.DateTime.incrementByInterval(c,this._unit)}this._markerLayer.style.display="block";this._lineLayer.style.display="block"};
Timeline.GregorianEtherPainter.prototype.softPaint=function(){};Timeline.GregorianEtherPainter.prototype.zoom=function(a){0!=a&&(this._unit+=a)};
Timeline.HotZoneGregorianEtherPainter=function(a){this._params=a;this._theme=a.theme;this._zones=[{startTime:Number.NEGATIVE_INFINITY,endTime:Number.POSITIVE_INFINITY,unit:a.unit,multiple:1}];for(var b=0;b<a.zones.length;b++)for(var c=a.zones[b],d=SimileAjax.DateTime.parseGregorianDateTime(c.start).getTime(),e=SimileAjax.DateTime.parseGregorianDateTime(c.end).getTime(),g=0;g<this._zones.length&&e>d;g++){var f=this._zones[g];d<f.endTime&&(d>f.startTime&&(this._zones.splice(g,0,{startTime:f.startTime,
endTime:d,unit:f.unit,multiple:f.multiple}),g++,f.startTime=d),e<f.endTime?(this._zones.splice(g,0,{startTime:d,endTime:e,unit:c.unit,multiple:c.multiple?c.multiple:1}),g++,d=f.startTime=e):(f.multiple=c.multiple,f.unit=c.unit,d=f.endTime))}};
Timeline.HotZoneGregorianEtherPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._backgroundLayer=a.createLayerDiv(0);this._backgroundLayer.setAttribute("name","ether-background");this._backgroundLayer.className="timeline-ether-bg";this._lineLayer=this._markerLayer=null;var c="align"in this._params&&void 0!=this._params.align?this._params.align:this._theme.ether.interval.marker[b.isHorizontal()?"hAlign":"vAlign"];this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,
this._band,this._theme,c,"showLine"in this._params?this._params.showLine:this._theme.ether.interval.line.show);this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)};Timeline.HotZoneGregorianEtherPainter.prototype.setHighlight=function(a,b){this._highlight.position(a,b)};
Timeline.HotZoneGregorianEtherPainter.prototype.paint=function(){this._markerLayer&&this._band.removeLayerDiv(this._markerLayer);this._markerLayer=this._band.createLayerDiv(100);this._markerLayer.setAttribute("name","ether-markers");this._markerLayer.style.display="none";this._lineLayer&&this._band.removeLayerDiv(this._lineLayer);this._lineLayer=this._band.createLayerDiv(1);this._lineLayer.setAttribute("name","ether-lines");this._lineLayer.style.display="none";for(var a=this._band.getMinDate(),b=
this._band.getMaxDate(),c=this._band.getTimeZone(),d=this._band.getLabeller(),e=0;e<this._zones.length&&!(a.getTime()<this._zones[e].endTime);)e++;for(var g=this._zones.length-1;0<=g&&!(b.getTime()>this._zones[g].startTime);)g--;for(;e<=g;e++){var f=this._zones[e],h=new Date(Math.max(a.getTime(),f.startTime)),j=new Date(Math.min(b.getTime(),f.endTime));SimileAjax.DateTime.roundDownToInterval(h,f.unit,c,f.multiple,this._theme.firstDayOfWeek);for(SimileAjax.DateTime.roundUpToInterval(j,f.unit,c,f.multiple,
this._theme.firstDayOfWeek);h.getTime()<j.getTime();){this._intervalMarkerLayout.createIntervalMarker(h,d,f.unit,this._markerLayer,this._lineLayer);for(var k=h,m=f,l=0;l<m.multiple;l++)SimileAjax.DateTime.incrementByInterval(k,m.unit)}}this._markerLayer.style.display="block";this._lineLayer.style.display="block"};Timeline.HotZoneGregorianEtherPainter.prototype.softPaint=function(){};
Timeline.HotZoneGregorianEtherPainter.prototype.zoom=function(a){if(0!=a)for(var b=0;b<this._zones.length;++b)this._zones[b]&&(this._zones[b].unit+=a)};Timeline.YearCountEtherPainter=function(a){this._params=a;this._theme=a.theme;this._startDate=SimileAjax.DateTime.parseGregorianDateTime(a.startDate);this._multiple="multiple"in a?a.multiple:1};
Timeline.YearCountEtherPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._backgroundLayer=a.createLayerDiv(0);this._backgroundLayer.setAttribute("name","ether-background");this._backgroundLayer.className="timeline-ether-bg";this._lineLayer=this._markerLayer=null;var c="align"in this._params?this._params.align:this._theme.ether.interval.marker[b.isHorizontal()?"hAlign":"vAlign"];this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,this._band,
this._theme,c,"showLine"in this._params?this._params.showLine:this._theme.ether.interval.line.show);this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)};Timeline.YearCountEtherPainter.prototype.setHighlight=function(a,b){this._highlight.position(a,b)};
Timeline.YearCountEtherPainter.prototype.paint=function(){this._markerLayer&&this._band.removeLayerDiv(this._markerLayer);this._markerLayer=this._band.createLayerDiv(100);this._markerLayer.setAttribute("name","ether-markers");this._markerLayer.style.display="none";this._lineLayer&&this._band.removeLayerDiv(this._lineLayer);this._lineLayer=this._band.createLayerDiv(1);this._lineLayer.setAttribute("name","ether-lines");this._lineLayer.style.display="none";var a=new Date(this._startDate.getTime()),b=
this._band.getMaxDate(),c=this._band.getMinDate().getUTCFullYear()-this._startDate.getUTCFullYear();a.setUTCFullYear(this._band.getMinDate().getUTCFullYear()-c%this._multiple);for(var d=this,c={labelInterval:function(a){a=a.getUTCFullYear()-d._startDate.getUTCFullYear();return{text:a,emphasized:0==a}}};a.getTime()<b.getTime();){this._intervalMarkerLayout.createIntervalMarker(a,c,SimileAjax.DateTime.YEAR,this._markerLayer,this._lineLayer);for(var e=a,g=0;g<d._multiple;g++)SimileAjax.DateTime.incrementByInterval(e,
SimileAjax.DateTime.YEAR)}this._markerLayer.style.display="block";this._lineLayer.style.display="block"};Timeline.YearCountEtherPainter.prototype.softPaint=function(){};Timeline.QuarterlyEtherPainter=function(a){this._params=a;this._theme=a.theme;this._startDate=SimileAjax.DateTime.parseGregorianDateTime(a.startDate)};
Timeline.QuarterlyEtherPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._backgroundLayer=a.createLayerDiv(0);this._backgroundLayer.setAttribute("name","ether-background");this._backgroundLayer.className="timeline-ether-bg";this._lineLayer=this._markerLayer=null;var c="align"in this._params?this._params.align:this._theme.ether.interval.marker[b.isHorizontal()?"hAlign":"vAlign"];this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,this._band,
this._theme,c,"showLine"in this._params?this._params.showLine:this._theme.ether.interval.line.show);this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)};Timeline.QuarterlyEtherPainter.prototype.setHighlight=function(a,b){this._highlight.position(a,b)};
Timeline.QuarterlyEtherPainter.prototype.paint=function(){this._markerLayer&&this._band.removeLayerDiv(this._markerLayer);this._markerLayer=this._band.createLayerDiv(100);this._markerLayer.setAttribute("name","ether-markers");this._markerLayer.style.display="none";this._lineLayer&&this._band.removeLayerDiv(this._lineLayer);this._lineLayer=this._band.createLayerDiv(1);this._lineLayer.setAttribute("name","ether-lines");this._lineLayer.style.display="none";var a=new Date(0),b=this._band.getMaxDate();
a.setUTCFullYear(Math.max(this._startDate.getUTCFullYear(),this._band.getMinDate().getUTCFullYear()));a.setUTCMonth(this._startDate.getUTCMonth());for(var c=this,d={labelInterval:function(a){var b=(4+(a.getUTCMonth()-c._startDate.getUTCMonth())/3)%4;return 0!=b?{text:"Q"+(b+1),emphasized:!1}:{text:"Y"+(a.getUTCFullYear()-c._startDate.getUTCFullYear()+1),emphasized:!0}}};a.getTime()<b.getTime();)this._intervalMarkerLayout.createIntervalMarker(a,d,SimileAjax.DateTime.YEAR,this._markerLayer,this._lineLayer),
a.setUTCMonth(a.getUTCMonth()+3);this._markerLayer.style.display="block";this._lineLayer.style.display="block"};Timeline.QuarterlyEtherPainter.prototype.softPaint=function(){};
Timeline.EtherIntervalMarkerLayout=function(a,b,c,d,e){var g=a.isHorizontal();this.positionDiv=g?"Top"==d?function(a,b){a.style.left=b+"px";a.style.top="0px"}:function(a,b){a.style.left=b+"px";a.style.bottom="0px"}:"Left"==d?function(a,b){a.style.top=b+"px";a.style.left="0px"}:function(a,b){a.style.top=b+"px";a.style.right="0px"};var f=c.ether.interval.line,h=c.ether.interval.weekend,j=SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.DAY];this.createIntervalMarker=function(d,m,l,p,r){var n=
Math.round(b.dateToPixelOffset(d));if(e&&l!=SimileAjax.DateTime.WEEK){var q=a.getDocument().createElement("div");q.className="timeline-ether-lines";100>f.opacity&&SimileAjax.Graphics.setOpacity(q,f.opacity);g?q.style.left=n+"px":q.style.top=n+"px";r.appendChild(q)}if(l==SimileAjax.DateTime.WEEK){var q=c.firstDayOfWeek,q=new Date(d.getTime()+(6-q-7)*j),s=new Date(q.getTime()+2*j),q=Math.round(b.dateToPixelOffset(q)),s=Math.round(b.dateToPixelOffset(s)),s=Math.max(1,s-q),t=a.getDocument().createElement("div");
t.className="timeline-ether-weekends";100>h.opacity&&SimileAjax.Graphics.setOpacity(t,h.opacity);g?(t.style.left=q+"px",t.style.width=s+"px"):(t.style.top=q+"px",t.style.height=s+"px");r.appendChild(t)}d=m.labelInterval(d,l);m=a.getDocument().createElement("div");m.innerHTML=d.text;m.className="timeline-date-label timeline-actual-"+d.text;d.emphasized&&(m.className+=" timeline-date-label-em");this.positionDiv(m,n);p.appendChild(m);return m}};
Timeline.EtherHighlight=function(a,b,c,d){var e=a.isHorizontal();this._highlightDiv=null;this._createHighlightDiv=function(){if(null==this._highlightDiv){this._highlightDiv=a.getDocument().createElement("div");this._highlightDiv.setAttribute("name","ether-highlight");this._highlightDiv.className="timeline-ether-highlight";var b=c.ether.highlightOpacity;100>b&&SimileAjax.Graphics.setOpacity(this._highlightDiv,b);d.appendChild(this._highlightDiv)}};this.position=function(a,c){this._createHighlightDiv();
var d=Math.round(b.dateToPixelOffset(a)),j=Math.round(b.dateToPixelOffset(c)),j=Math.max(j-d,3);e?(this._highlightDiv.style.left=d+"px",this._highlightDiv.style.width=j+"px",this._highlightDiv.style.height=b.getViewWidth()-4+"px"):(this._highlightDiv.style.top=d+"px",this._highlightDiv.style.height=j+"px",this._highlightDiv.style.width=b.getViewWidth()-4+"px")}};Timeline.EventUtils={};
Timeline.EventUtils.getNewEventID=function(){null==this._lastEventID&&(this._lastEventID=0);this._lastEventID+=1;return"e"+this._lastEventID};Timeline.EventUtils.decodeEventElID=function(a){var b=a.split("-");if("tl"!=b[1])return alert("Internal Timeline problem 101, please consult support"),{band:null,evt:null};a=Timeline.getTimelineFromID(b[2]).getBand(b[3]);b=a.getEventSource.getEvent(b[4]);return{band:a,evt:b}};
Timeline.EventUtils.encodeEventElID=function(a,b,c,d){return c+"-tl-"+a.timelineID+"-"+b.getIndex()+"-"+d.getID()};Timeline.DefaultEventSource=function(a){this._events=a instanceof Object?a:new SimileAjax.EventIndex;this._listeners=[]};Timeline.DefaultEventSource.prototype.addListener=function(a){this._listeners.push(a)};Timeline.DefaultEventSource.prototype.removeListener=function(a){for(var b=0;b<this._listeners.length;b++)if(this._listeners[b]==a){this._listeners.splice(b,1);break}};
Timeline.DefaultEventSource.prototype.loadXML=function(a,b){for(var c=this._getBaseURL(b),d=a.documentElement.getAttribute("wiki-url"),e=a.documentElement.getAttribute("wiki-section"),g=a.documentElement.getAttribute("date-time-format"),g=this._events.getUnit().getParser(g),f=a.documentElement.firstChild,h=!1;null!=f;){if(1==f.nodeType){h="";null!=f.firstChild&&3==f.firstChild.nodeType&&(h=f.firstChild.nodeValue);var j=null===f.getAttribute("isDuration")&&null===f.getAttribute("durationEvent")||"false"==
f.getAttribute("isDuration")||"false"==f.getAttribute("durationEvent"),h=new Timeline.DefaultEventSource.Event({id:f.getAttribute("id"),start:g(f.getAttribute("start")),end:g(f.getAttribute("end")),latestStart:g(f.getAttribute("latestStart")),earliestEnd:g(f.getAttribute("earliestEnd")),instant:j,text:f.getAttribute("title"),description:h,image:this._resolveRelativeURL(f.getAttribute("image"),c),link:this._resolveRelativeURL(f.getAttribute("link"),c),icon:this._resolveRelativeURL(f.getAttribute("icon"),
c),color:f.getAttribute("color"),textColor:f.getAttribute("textColor"),hoverText:f.getAttribute("hoverText"),classname:f.getAttribute("classname"),tapeImage:f.getAttribute("tapeImage"),tapeRepeat:f.getAttribute("tapeRepeat"),caption:f.getAttribute("caption"),eventID:f.getAttribute("eventID"),trackNum:f.getAttribute("trackNum")});h._node=f;h.getProperty=function(a){return this._node.getAttribute(a)};h.setWikiInfo(d,e);this._events.add(h);h=!0}f=f.nextSibling}h&&this._fire("onAddMany",[])};
Timeline.DefaultEventSource.prototype.loadJSON=function(a,b){var c=this._getBaseURL(b),d=!1;if(a&&a.events){var e="wikiURL"in a?a.wikiURL:null,g="wikiSection"in a?a.wikiSection:null,f="dateTimeFormat"in a?a.dateTimeFormat:null,f=this._events.getUnit().getParser(f),h=0;for(;h<a.events.length;h++){var d=a.events[h],j=d.isDuration||null!=d.durationEvent&&!d.durationEvent,j=new Timeline.DefaultEventSource.Event({id:"id"in d?d.id:void 0,start:f(d.start),end:f(d.end),latestStart:f(d.latestStart),earliestEnd:f(d.earliestEnd),
instant:j,text:d.title,description:d.description,image:this._resolveRelativeURL(d.image,c),link:this._resolveRelativeURL(d.link,c),icon:this._resolveRelativeURL(d.icon,c),color:d.color,textColor:d.textColor,hoverText:d.hoverText,classname:d.classname,tapeImage:d.tapeImage,tapeRepeat:d.tapeRepeat,caption:d.caption,eventID:d.eventID,trackNum:d.trackNum});j._obj=d;j.getProperty=function(a){return this._obj[a]};j.setWikiInfo(e,g);this._events.add(j);d=!0}}d&&this._fire("onAddMany",[])};
Timeline.DefaultEventSource.prototype.loadSPARQL=function(a,b){var c=this._getBaseURL(b),d=this._events.getUnit().getParser("iso8601");if(null!=a){for(var e=a.documentElement.firstChild;null!=e&&(1!=e.nodeType||"results"!=e.nodeName);)e=e.nextSibling;var g=null,f=null;null!=e&&(g=e.getAttribute("wiki-url"),f=e.getAttribute("wiki-section"),e=e.firstChild);for(var h=!1;null!=e;){if(1==e.nodeType){for(var h={},j=e.firstChild;null!=j;)1==j.nodeType&&(null!=j.firstChild&&1==j.firstChild.nodeType&&null!=
j.firstChild.firstChild&&3==j.firstChild.firstChild.nodeType)&&(h[j.getAttribute("name")]=j.firstChild.firstChild.nodeValue),j=j.nextSibling;null==h.start&&null!=h.date&&(h.start=h.date);j=null===h.isDuration&&null===h.durationEvent||"false"==h.isDuration||"false"==h.durationEvent;j=new Timeline.DefaultEventSource.Event({id:h.id,start:d(h.start),end:d(h.end),latestStart:d(h.latestStart),earliestEnd:d(h.earliestEnd),instant:j,text:h.title,description:h.description,image:this._resolveRelativeURL(h.image,
c),link:this._resolveRelativeURL(h.link,c),icon:this._resolveRelativeURL(h.icon,c),color:h.color,textColor:h.textColor,hoverText:h.hoverText,caption:h.caption,classname:h.classname,tapeImage:h.tapeImage,tapeRepeat:h.tapeRepeat,eventID:h.eventID,trackNum:h.trackNum});j._bindings=h;j.getProperty=function(a){return this._bindings[a]};j.setWikiInfo(g,f);this._events.add(j);h=!0}e=e.nextSibling}h&&this._fire("onAddMany",[])}};
Timeline.DefaultEventSource.prototype.add=function(a){this._events.add(a);this._fire("onAddOne",[a])};Timeline.DefaultEventSource.prototype.addMany=function(a){for(var b=0;b<a.length;b++)this._events.add(a[b]);this._fire("onAddMany",[])};Timeline.DefaultEventSource.prototype.clear=function(){this._events.removeAll();this._fire("onClear",[])};Timeline.DefaultEventSource.prototype.getEvent=function(a){return this._events.getEvent(a)};
Timeline.DefaultEventSource.prototype.getEventIterator=function(a,b){return this._events.getIterator(a,b)};Timeline.DefaultEventSource.prototype.getEventReverseIterator=function(a,b){return this._events.getReverseIterator(a,b)};Timeline.DefaultEventSource.prototype.getAllEventIterator=function(){return this._events.getAllIterator()};Timeline.DefaultEventSource.prototype.getCount=function(){return this._events.getCount()};Timeline.DefaultEventSource.prototype.getEarliestDate=function(){return this._events.getEarliestDate()};
Timeline.DefaultEventSource.prototype.getLatestDate=function(){return this._events.getLatestDate()};Timeline.DefaultEventSource.prototype._fire=function(a,b){for(var c=0;c<this._listeners.length;c++){var d=this._listeners[c];if(a in d)try{d[a].apply(d,b)}catch(e){SimileAjax.Debug.exception(e)}}};
Timeline.DefaultEventSource.prototype._getBaseURL=function(a){if(0>a.indexOf("://")){var b=this._getBaseURL(document.location.href);a="/"==a.substr(0,1)?b.substr(0,b.indexOf("/",b.indexOf("://")+3))+a:b+a}b=a.lastIndexOf("/");return 0>b?"":a.substr(0,b+1)};Timeline.DefaultEventSource.prototype._resolveRelativeURL=function(a,b){return null==a||""==a?a:0<a.indexOf("://")?a:"/"==a.substr(0,1)?b.substr(0,b.indexOf("/",b.indexOf("://")+3))+a:b+a};
Timeline.DefaultEventSource.Event=function(a){function b(b){return null!=a[b]&&""!=a[b]?a[b]:null}var c=a.id?a.id.trim():"";this._id=0<c.length?c:Timeline.EventUtils.getNewEventID();this._instant=a.instant||null==a.end;this._start=a.start;this._end=null!=a.end?a.end:a.start;this._latestStart=null!=a.latestStart?a.latestStart:a.instant?this._end:this._start;this._earliestEnd=null!=a.earliestEnd?a.earliestEnd:this._end;c=[];this._start>this._latestStart&&(this._latestStart=this._start,c.push("start is > latestStart"));
this._start>this._earliestEnd&&(this._earliestEnd=this._latestStart,c.push("start is > earliestEnd"));this._start>this._end&&(this._end=this._earliestEnd,c.push("start is > end"));this._latestStart>this._earliestEnd&&(this._earliestEnd=this._latestStart,c.push("latestStart is > earliestEnd"));this._latestStart>this._end&&(this._end=this._earliestEnd,c.push("latestStart is > end"));this._earliestEnd>this._end&&(this._end=this._earliestEnd,c.push("earliestEnd is > end"));this._eventID=b("eventID");
this._text=null!=a.text?SimileAjax.HTML.deEntify(a.text):"";0<c.length&&(this._text+=" PROBLEM: "+c.join(", "));this._description=SimileAjax.HTML.deEntify(a.description);this._image=b("image");this._link=b("link");this._title=b("hoverText");this._title=b("caption");this._icon=b("icon");this._color=b("color");this._textColor=b("textColor");this._classname=b("classname");this._tapeImage=b("tapeImage");this._tapeRepeat=b("tapeRepeat");this._trackNum=b("trackNum");null!=this._trackNum&&(this._trackNum=
parseInt(this._trackNum));this._wikiSection=this._wikiURL=null};
Timeline.DefaultEventSource.Event.prototype={getID:function(){return this._id},isInstant:function(){return this._instant},isImprecise:function(){return this._start!=this._latestStart||this._end!=this._earliestEnd},getStart:function(){return this._start},getEnd:function(){return this._end},getLatestStart:function(){return this._latestStart},getEarliestEnd:function(){return this._earliestEnd},getEventID:function(){return this._eventID},getText:function(){return this._text},getDescription:function(){return this._description},
getImage:function(){return this._image},getLink:function(){return this._link},getIcon:function(){return this._icon},getColor:function(){return this._color},getTextColor:function(){return this._textColor},getClassName:function(){return this._classname},getTapeImage:function(){return this._tapeImage},getTapeRepeat:function(){return this._tapeRepeat},getTrackNum:function(){return this._trackNum},getProperty:function(){return null},getWikiURL:function(){return this._wikiURL},getWikiSection:function(){return this._wikiSection},
setWikiInfo:function(a,b){this._wikiURL=a;this._wikiSection=b},fillDescription:function(a){a.innerHTML=this._description},fillWikiInfo:function(a){a.style.display="none";if(!(null==this._wikiURL||null==this._wikiSection)){var b=this.getProperty("wikiID");if(null==b||0==b.length)b=this.getText();if(!(null==b||0==b.length)){a.style.display="inline";var b=b.replace(/\s/g,"_"),b=this._wikiURL+this._wikiSection.replace(/\s/g,"_")+"/"+b,c=document.createElement("a");c.href=b;c.target="new";c.innerHTML=
Timeline.strings[Timeline.clientLocale].wikiLinkLabel;a.appendChild(document.createTextNode("["));a.appendChild(c);a.appendChild(document.createTextNode("]"))}}},fillTime:function(a,b){this._instant?this.isImprecise()?(a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._start))),a.appendChild(a.ownerDocument.createElement("br")),a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._end)))):a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._start))):this.isImprecise()?
(a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._start)+" ~ "+b.labelPrecise(this._latestStart))),a.appendChild(a.ownerDocument.createElement("br")),a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._earliestEnd)+" ~ "+b.labelPrecise(this._end)))):(a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._start))),a.appendChild(a.ownerDocument.createElement("br")),a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._end))))},fillInfoBubble:function(a,
b,c){var d=a.ownerDocument,e=this.getText(),g=this.getLink(),f=this.getImage();if(null!=f){var h=d.createElement("img");h.src=f;b.event.bubble.imageStyler(h);a.appendChild(h)}f=d.createElement("div");e=d.createTextNode(e);null!=g?(h=d.createElement("a"),h.href=g,h.appendChild(e),f.appendChild(h)):f.appendChild(e);b.event.bubble.titleStyler(f);a.appendChild(f);g=d.createElement("div");this.fillDescription(g);b.event.bubble.bodyStyler(g);a.appendChild(g);g=d.createElement("div");this.fillTime(g,c);
b.event.bubble.timeStyler(g);a.appendChild(g);c=d.createElement("div");this.fillWikiInfo(c);b.event.bubble.wikiStyler(c);a.appendChild(c)}};Timeline.OriginalEventPainter=function(a){this._params=a;this._onSelectListeners=[];this._eventPaintListeners=[];this._frc=this._highlightMatcher=this._filterMatcher=null;this._eventIdToElmt={}};
Timeline.OriginalEventPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._eventIdToElmt=this._highlightLayer=this._lineLayer=this._eventLayer=this._backLayer=null};Timeline.OriginalEventPainter.prototype.getType=function(){return"original"};Timeline.OriginalEventPainter.prototype.addOnSelectListener=function(a){this._onSelectListeners.push(a)};
Timeline.OriginalEventPainter.prototype.removeOnSelectListener=function(a){for(var b=0;b<this._onSelectListeners.length;b++)if(this._onSelectListeners[b]==a){this._onSelectListeners.splice(b,1);break}};Timeline.OriginalEventPainter.prototype.addEventPaintListener=function(a){this._eventPaintListeners.push(a)};
Timeline.OriginalEventPainter.prototype.removeEventPaintListener=function(a){for(var b=0;b<this._eventPaintListeners.length;b++)if(this._eventPaintListeners[b]==a){this._eventPaintListeners.splice(b,1);break}};Timeline.OriginalEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher};Timeline.OriginalEventPainter.prototype.setFilterMatcher=function(a){this._filterMatcher=a};Timeline.OriginalEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher};
Timeline.OriginalEventPainter.prototype.setHighlightMatcher=function(a){this._highlightMatcher=a};
Timeline.OriginalEventPainter.prototype.paint=function(){var a=this._band.getEventSource();if(null!=a){this._eventIdToElmt={};this._fireEventPaintListeners("paintStarting",null,null);this._prepareForPainting();for(var b=this._params.theme.event,c=Math.max(b.track.height,b.tape.height+this._frc.getLineHeight()),b={trackOffset:b.track.offset,trackHeight:c,trackGap:b.track.gap,trackIncrement:c+b.track.gap,icon:b.instant.icon,iconWidth:b.instant.iconWidth,iconHeight:b.instant.iconHeight,labelWidth:b.label.width,
maxLabelChar:b.label.maxLabelChar,impreciseIconMargin:b.instant.impreciseIconMargin},d=this._band.getMinDate(),e=this._band.getMaxDate(),c=null!=this._filterMatcher?this._filterMatcher:function(){return!0},g=null!=this._highlightMatcher?this._highlightMatcher:function(){return-1},a=a.getEventReverseIterator(d,e);a.hasNext();)d=a.next(),c(d)&&this.paintEvent(d,b,this._params.theme,g(d));this._highlightLayer.style.display="block";this._lineLayer.style.display="block";this._eventLayer.style.display=
"block";this._band.updateEventTrackInfo(this._tracks.length,b.trackIncrement);this._fireEventPaintListeners("paintEnded",null,null)}};Timeline.OriginalEventPainter.prototype.softPaint=function(){};
Timeline.OriginalEventPainter.prototype._prepareForPainting=function(){var a=this._band;if(null==this._backLayer){this._backLayer=this._band.createLayerDiv(0,"timeline-band-events");this._backLayer.style.visibility="hidden";var b=document.createElement("span");b.className="timeline-event-label";this._backLayer.appendChild(b);this._frc=SimileAjax.Graphics.getFontRenderingContext(b)}this._frc.update();this._tracks=[];null!=this._highlightLayer&&a.removeLayerDiv(this._highlightLayer);this._highlightLayer=
a.createLayerDiv(105,"timeline-band-highlights");this._highlightLayer.style.display="none";null!=this._lineLayer&&a.removeLayerDiv(this._lineLayer);this._lineLayer=a.createLayerDiv(110,"timeline-band-lines");this._lineLayer.style.display="none";null!=this._eventLayer&&a.removeLayerDiv(this._eventLayer);this._eventLayer=a.createLayerDiv(115,"timeline-band-events");this._eventLayer.style.display="none"};
Timeline.OriginalEventPainter.prototype.paintEvent=function(a,b,c,d){a.isInstant()?this.paintInstantEvent(a,b,c,d):this.paintDurationEvent(a,b,c,d)};Timeline.OriginalEventPainter.prototype.paintInstantEvent=function(a,b,c,d){a.isImprecise()?this.paintImpreciseInstantEvent(a,b,c,d):this.paintPreciseInstantEvent(a,b,c,d)};Timeline.OriginalEventPainter.prototype.paintDurationEvent=function(a,b,c,d){a.isImprecise()?this.paintImpreciseDurationEvent(a,b,c,d):this.paintPreciseDurationEvent(a,b,c,d)};
Timeline.OriginalEventPainter.prototype.paintPreciseInstantEvent=function(a,b,c,d){this._timeline.getDocument();var e=a.getText(),g=a.getStart(),g=Math.round(this._band.dateToPixelOffset(g)),f=Math.round(g+b.iconWidth/2),g=Math.round(g-b.iconWidth/2),h=this._getLabelDivClassName(a),j=this._frc.computeSize(e,h),k=f+c.event.label.offsetFromLine,f=this._findFreeTrack(a,k+j.width),m=Math.round(b.trackOffset+f*b.trackIncrement+b.trackHeight/2-j.height/2),l=this._paintEventIcon(a,f,g,b,c,0),e=this._paintEventLabel(a,
e,k,m,j.width,j.height,c,h,d);b=[l.elmt,e.elmt];var p=this,h=function(b,c){return p._onClickInstantEvent(l.elmt,c,a)};SimileAjax.DOM.registerEvent(l.elmt,"mousedown",h);SimileAjax.DOM.registerEvent(e.elmt,"mousedown",h);c=this._createHighlightDiv(d,l,c,a);null!=c&&b.push(c);this._fireEventPaintListeners("paintedEvent",a,b);this._eventIdToElmt[a.getID()]=l.elmt;this._tracks[f]=g};
Timeline.OriginalEventPainter.prototype.paintImpreciseInstantEvent=function(a,b,c,d){this._timeline.getDocument();var e=a.getText(),g=a.getStart(),f=a.getEnd(),h=Math.round(this._band.dateToPixelOffset(g)),j=Math.round(this._band.dateToPixelOffset(f)),g=Math.round(h+b.iconWidth/2),f=Math.round(h-b.iconWidth/2),k=this._getLabelDivClassName(a),m=this._frc.computeSize(e,k),l=g+c.event.label.offsetFromLine,g=Math.max(l+m.width,j),g=this._findFreeTrack(a,g),p=c.event.tape.height,r=Math.round(b.trackOffset+
g*b.trackIncrement+p),n=this._paintEventIcon(a,g,f,b,c,p),e=this._paintEventLabel(a,e,l,r,m.width,m.height,c,k,d),k=a.getColor(),k=null!=k?k:c.event.instant.impreciseColor,h=this._paintEventTape(a,g,h,j,k,c.event.instant.impreciseOpacity,b,c,0);b=[n.elmt,e.elmt,h.elmt];var q=this,j=function(b,c){return q._onClickInstantEvent(n.elmt,c,a)};SimileAjax.DOM.registerEvent(n.elmt,"mousedown",j);SimileAjax.DOM.registerEvent(h.elmt,"mousedown",j);SimileAjax.DOM.registerEvent(e.elmt,"mousedown",j);c=this._createHighlightDiv(d,
n,c,a);null!=c&&b.push(c);this._fireEventPaintListeners("paintedEvent",a,b);this._eventIdToElmt[a.getID()]=n.elmt;this._tracks[g]=f};
Timeline.OriginalEventPainter.prototype.paintPreciseDurationEvent=function(a,b,c,d){this._timeline.getDocument();var e=a.getText(),g=a.getStart(),f=a.getEnd(),g=Math.round(this._band.dateToPixelOffset(g)),h=Math.round(this._band.dateToPixelOffset(f)),j=this._getLabelDivClassName(a),k=this._frc.computeSize(e,j),f=Math.max(g+k.width,h),f=this._findFreeTrack(a,f),m=Math.round(b.trackOffset+f*b.trackIncrement+c.event.tape.height),l=a.getColor(),l=null!=l?l:c.event.duration.color,p=this._paintEventTape(a,
f,g,h,l,100,b,c,0),e=this._paintEventLabel(a,e,g,m,k.width,k.height,c,j,d);b=[p.elmt,e.elmt];var r=this,h=function(b,c){return r._onClickDurationEvent(p.elmt,c,a)};SimileAjax.DOM.registerEvent(p.elmt,"mousedown",h);SimileAjax.DOM.registerEvent(e.elmt,"mousedown",h);c=this._createHighlightDiv(d,p,c,a);null!=c&&b.push(c);this._fireEventPaintListeners("paintedEvent",a,b);this._eventIdToElmt[a.getID()]=p.elmt;this._tracks[f]=g};
Timeline.OriginalEventPainter.prototype.paintImpreciseDurationEvent=function(a,b,c,d){this._timeline.getDocument();var e=a.getText(),g=a.getStart(),f=a.getLatestStart(),h=a.getEnd(),j=a.getEarliestEnd(),g=Math.round(this._band.dateToPixelOffset(g)),f=Math.round(this._band.dateToPixelOffset(f)),h=Math.round(this._band.dateToPixelOffset(h)),k=Math.round(this._band.dateToPixelOffset(j)),m=this._getLabelDivClassName(a),l=this._frc.computeSize(e,m),j=Math.max(f+l.width,h),j=this._findFreeTrack(a,j),p=
Math.round(b.trackOffset+j*b.trackIncrement+c.event.tape.height),r=a.getColor(),r=null!=r?r:c.event.duration.color,h=this._paintEventTape(a,j,g,h,c.event.duration.impreciseColor,c.event.duration.impreciseOpacity,b,c,0),n=this._paintEventTape(a,j,f,k,r,100,b,c,1);b=this._paintEventLabel(a,e,f,p,l.width,l.height,c,m,d);var e=[h.elmt,n.elmt,b.elmt],q=this,f=function(b,c){return q._onClickDurationEvent(n.elmt,c,a)};SimileAjax.DOM.registerEvent(n.elmt,"mousedown",f);SimileAjax.DOM.registerEvent(b.elmt,
"mousedown",f);c=this._createHighlightDiv(d,n,c,a);null!=c&&e.push(c);this._fireEventPaintListeners("paintedEvent",a,e);this._eventIdToElmt[a.getID()]=n.elmt;this._tracks[j]=g};Timeline.OriginalEventPainter.prototype._encodeEventElID=function(a,b){return Timeline.EventUtils.encodeEventElID(this._timeline,this._band,a,b)};Timeline.OriginalEventPainter.prototype._findFreeTrack=function(a,b){var c=a.getTrackNum();if(null!=c)return c;for(c=0;c<this._tracks.length&&!(this._tracks[c]>b);c++);return c};
Timeline.OriginalEventPainter.prototype._paintEventIcon=function(a,b,c,d,e,g){e=a.getIcon();e=null!=e?e:d.icon;b=0<g?d.trackOffset+b*d.trackIncrement+g+d.impreciseIconMargin:Math.round(d.trackOffset+b*d.trackIncrement+d.trackHeight/2-d.iconHeight/2);g=SimileAjax.Graphics.createTranslucentImage(e);e=this._timeline.getDocument().createElement("div");e.className=this._getElClassName("timeline-event-icon",a,"icon");e.id=this._encodeEventElID("icon",a);e.style.left=c+"px";e.style.top=b+"px";e.appendChild(g);
null!=a._title&&(e.title=a._title);this._eventLayer.appendChild(e);return{left:c,top:b,width:d.iconWidth,height:d.iconHeight,elmt:e}};
Timeline.OriginalEventPainter.prototype._paintEventLabel=function(a,b,c,d,e,g,f,h,j){var k=this._timeline.getDocument().createElement("div");k.className=h;k.id=this._encodeEventElID("label",a);k.style.left=c+"px";k.style.width=e+"px";k.style.top=d+"px";k.innerHTML=b;null!=a._title&&(k.title=a._title);b=a.getTextColor();null==b&&(b=a.getColor());null!=b&&(k.style.color=b);f.event.highlightLabelBackground&&0<=j&&(k.style.background=this._getHighlightColor(j,f));this._eventLayer.appendChild(k);return{left:c,
top:d,width:e,height:g,elmt:k}};
Timeline.OriginalEventPainter.prototype._paintEventTape=function(a,b,c,d,e,g,f,h,j){d-=c;h=h.event.tape.height;b=f.trackOffset+b*f.trackIncrement;f=this._timeline.getDocument().createElement("div");f.className=this._getElClassName("timeline-event-tape",a,"tape");f.id=this._encodeEventElID("tape"+j,a);f.style.left=c+"px";f.style.width=d+"px";f.style.height=h+"px";f.style.top=b+"px";null!=a._title&&(f.title=a._title);null!=e&&(f.style.backgroundColor=e);e=a.getTapeImage();a=a.getTapeRepeat();a=null!=
a?a:"repeat";null!=e&&(f.style.backgroundImage="url("+e+")",f.style.backgroundRepeat=a);SimileAjax.Graphics.setOpacity(f,g);this._eventLayer.appendChild(f);return{left:c,top:b,width:d,height:h,elmt:f}};Timeline.OriginalEventPainter.prototype._getLabelDivClassName=function(a){return this._getElClassName("timeline-event-label",a,"label")};Timeline.OriginalEventPainter.prototype._getElClassName=function(a,b,c){b=b.getClassName();var d=[];b&&(c&&d.push(c+"-"+b+" "),d.push(b+" "));d.push(a);return d.join("")};
Timeline.OriginalEventPainter.prototype._getHighlightColor=function(a,b){var c=b.event.highlightColors;return c[Math.min(a,c.length-1)]};
Timeline.OriginalEventPainter.prototype._createHighlightDiv=function(a,b,c,d){var e=null;0<=a&&(e=this._timeline.getDocument(),a=this._getHighlightColor(a,c),e=e.createElement("div"),e.className=this._getElClassName("timeline-event-highlight",d,"highlight"),e.id=this._encodeEventElID("highlight0",d),e.style.position="absolute",e.style.overflow="hidden",e.style.left=b.left-2+"px",e.style.width=b.width+4+"px",e.style.top=b.top-2+"px",e.style.height=b.height+4+"px",e.style.background=a,this._highlightLayer.appendChild(e));
return e};Timeline.OriginalEventPainter.prototype._onClickInstantEvent=function(a,b,c){var d=SimileAjax.DOM.getPageCoordinates(a);Math.ceil(a.offsetWidth/2);Math.ceil(a.offsetHeight/2);this._showBubble(d.left+Math.ceil(a.offsetWidth/2),d.top+Math.ceil(a.offsetHeight/2),c);this._fireOnSelect(c.getID());b.cancelBubble=!0;SimileAjax.DOM.cancelEvent(b);return!1};
Timeline.OriginalEventPainter.prototype._onClickDurationEvent=function(a,b,c){a=SimileAjax.DOM.getPageCoordinates(a);this._showBubble(b.offsetX+a.left,b.offsetY+a.top,c);this._fireOnSelect(c.getID());b.cancelBubble=!0;SimileAjax.DOM.cancelEvent(b);return!1};Timeline.OriginalEventPainter.prototype.showBubble=function(a){var b=this._eventIdToElmt[a.getID()];if(b){var c=SimileAjax.DOM.getPageCoordinates(b);this._showBubble(c.left+b.offsetWidth/2,c.top+b.offsetHeight/2,a)}};
Timeline.OriginalEventPainter.prototype._showBubble=function(a,b,c){var d=document.createElement("div"),e=this._params.theme.event.bubble;c.fillInfoBubble(d,this._params.theme,this._band.getLabeller());SimileAjax.WindowManager.cancelPopups();SimileAjax.Graphics.createBubbleForContentAndPoint(d,a,b,e.width,null,e.maxHeight)};Timeline.OriginalEventPainter.prototype._fireOnSelect=function(a){for(var b=0;b<this._onSelectListeners.length;b++)this._onSelectListeners[b](a)};
Timeline.OriginalEventPainter.prototype._fireEventPaintListeners=function(a,b,c){for(var d=0;d<this._eventPaintListeners.length;d++)this._eventPaintListeners[d](this._band,a,b,c)};Timeline.DetailedEventPainter=function(a){this._params=a;this._onSelectListeners=[];this._frc=this._highlightMatcher=this._filterMatcher=null;this._eventIdToElmt={}};
Timeline.DetailedEventPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._eventIdToElmt=this._highlightLayer=this._lineLayer=this._eventLayer=this._backLayer=null};Timeline.DetailedEventPainter.prototype.getType=function(){return"detailed"};Timeline.DetailedEventPainter.prototype.addOnSelectListener=function(a){this._onSelectListeners.push(a)};
Timeline.DetailedEventPainter.prototype.removeOnSelectListener=function(a){for(var b=0;b<this._onSelectListeners.length;b++)if(this._onSelectListeners[b]==a){this._onSelectListeners.splice(b,1);break}};Timeline.DetailedEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher};Timeline.DetailedEventPainter.prototype.setFilterMatcher=function(a){this._filterMatcher=a};Timeline.DetailedEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher};
Timeline.DetailedEventPainter.prototype.setHighlightMatcher=function(a){this._highlightMatcher=a};
Timeline.DetailedEventPainter.prototype.paint=function(){var a=this._band.getEventSource();if(null!=a){this._eventIdToElmt={};this._prepareForPainting();for(var b=this._params.theme.event,c=Math.max(b.track.height,this._frc.getLineHeight()),b={trackOffset:Math.round(this._band.getViewWidth()/2-c/2),trackHeight:c,trackGap:b.track.gap,trackIncrement:c+b.track.gap,icon:b.instant.icon,iconWidth:b.instant.iconWidth,iconHeight:b.instant.iconHeight,labelWidth:b.label.width},d=this._band.getMinDate(),e=this._band.getMaxDate(),
c=null!=this._filterMatcher?this._filterMatcher:function(){return!0},g=null!=this._highlightMatcher?this._highlightMatcher:function(){return-1},a=a.getEventReverseIterator(d,e);a.hasNext();)d=a.next(),c(d)&&this.paintEvent(d,b,this._params.theme,g(d));this._highlightLayer.style.display="block";this._lineLayer.style.display="block";this._eventLayer.style.display="block";this._band.updateEventTrackInfo(this._lowerTracks.length+this._upperTracks.length,b.trackIncrement)}};
Timeline.DetailedEventPainter.prototype.softPaint=function(){};
Timeline.DetailedEventPainter.prototype._prepareForPainting=function(){var a=this._band;if(null==this._backLayer){this._backLayer=this._band.createLayerDiv(0,"timeline-band-events");this._backLayer.style.visibility="hidden";var b=document.createElement("span");b.className="timeline-event-label";this._backLayer.appendChild(b);this._frc=SimileAjax.Graphics.getFontRenderingContext(b)}this._frc.update();this._lowerTracks=[];this._upperTracks=[];null!=this._highlightLayer&&a.removeLayerDiv(this._highlightLayer);
this._highlightLayer=a.createLayerDiv(105,"timeline-band-highlights");this._highlightLayer.style.display="none";null!=this._lineLayer&&a.removeLayerDiv(this._lineLayer);this._lineLayer=a.createLayerDiv(110,"timeline-band-lines");this._lineLayer.style.display="none";null!=this._eventLayer&&a.removeLayerDiv(this._eventLayer);this._eventLayer=a.createLayerDiv(110,"timeline-band-events");this._eventLayer.style.display="none"};
Timeline.DetailedEventPainter.prototype.paintEvent=function(a,b,c,d){a.isInstant()?this.paintInstantEvent(a,b,c,d):this.paintDurationEvent(a,b,c,d)};Timeline.DetailedEventPainter.prototype.paintInstantEvent=function(a,b,c,d){a.isImprecise()?this.paintImpreciseInstantEvent(a,b,c,d):this.paintPreciseInstantEvent(a,b,c,d)};Timeline.DetailedEventPainter.prototype.paintDurationEvent=function(a,b,c,d){a.isImprecise()?this.paintImpreciseDurationEvent(a,b,c,d):this.paintPreciseDurationEvent(a,b,c,d)};
Timeline.DetailedEventPainter.prototype.paintPreciseInstantEvent=function(a,b,c,d){this._timeline.getDocument();var e=a.getText(),g=a.getStart(),f=Math.round(this._band.dateToPixelOffset(g)),h=Math.round(f+b.iconWidth/2),j=Math.round(f-b.iconWidth/2),g=this._frc.computeSize(e),k=this._findFreeTrackForSolid(h,f),m=this._paintEventIcon(a,k,j,b,c),h=h+c.event.label.offsetFromLine,l=k,p=this._getTrackData(k);Math.min(p.solid,p.text)>=h+g.width?(p.solid=j,p.text=h):(p.solid=j,h=f+c.event.label.offsetFromLine,
l=this._findFreeTrackForText(k,h+g.width,function(a){a.line=f-2}),this._getTrackData(l).text=j,this._paintEventLine(a,f,k,l,b,c));b=Math.round(b.trackOffset+l*b.trackIncrement+b.trackHeight/2-g.height/2);var e=this._paintEventLabel(a,e,h,b,g.width,g.height,c),r=this;b=function(b,c){return r._onClickInstantEvent(m.elmt,c,a)};SimileAjax.DOM.registerEvent(m.elmt,"mousedown",b);SimileAjax.DOM.registerEvent(e.elmt,"mousedown",b);this._createHighlightDiv(d,m,c);this._eventIdToElmt[a.getID()]=m.elmt};
Timeline.DetailedEventPainter.prototype.paintImpreciseInstantEvent=function(a,b,c,d){this._timeline.getDocument();var e=a.getText(),g=a.getStart(),f=a.getEnd(),h=Math.round(this._band.dateToPixelOffset(g)),j=Math.round(this._band.dateToPixelOffset(f)),k=Math.round(h+b.iconWidth/2),m=Math.round(h-b.iconWidth/2),f=this._frc.computeSize(e),l=this._findFreeTrackForSolid(j,h),g=this._paintEventTape(a,l,h,j,c.event.instant.impreciseColor,c.event.instant.impreciseOpacity,b,c),p=this._paintEventIcon(a,l,
m,b,c);this._getTrackData(l).solid=m;var k=k+c.event.label.offsetFromLine,r=k+f.width;r<j?j=l:(k=h+c.event.label.offsetFromLine,r=k+f.width,j=this._findFreeTrackForText(l,r,function(a){a.line=h-2}),this._getTrackData(j).text=m,this._paintEventLine(a,h,l,j,b,c));b=Math.round(b.trackOffset+j*b.trackIncrement+b.trackHeight/2-f.height/2);var e=this._paintEventLabel(a,e,k,b,f.width,f.height,c),n=this;b=function(b,c){return n._onClickInstantEvent(p.elmt,c,a)};SimileAjax.DOM.registerEvent(p.elmt,"mousedown",
b);SimileAjax.DOM.registerEvent(g.elmt,"mousedown",b);SimileAjax.DOM.registerEvent(e.elmt,"mousedown",b);this._createHighlightDiv(d,p,c);this._eventIdToElmt[a.getID()]=p.elmt};
Timeline.DetailedEventPainter.prototype.paintPreciseDurationEvent=function(a,b,c,d){this._timeline.getDocument();var e=a.getText(),g=a.getStart(),f=a.getEnd(),h=Math.round(this._band.dateToPixelOffset(g)),j=Math.round(this._band.dateToPixelOffset(f)),g=this._frc.computeSize(e),f=this._findFreeTrackForSolid(j),k=a.getColor(),k=null!=k?k:c.event.duration.color,m=this._paintEventTape(a,f,h,j,k,100,b,c);this._getTrackData(f).solid=h;j=h+c.event.label.offsetFromLine;k=this._findFreeTrackForText(f,j+g.width,
function(a){a.line=h-2});this._getTrackData(k).text=h-2;this._paintEventLine(a,h,f,k,b,c);b=Math.round(b.trackOffset+k*b.trackIncrement+b.trackHeight/2-g.height/2);var e=this._paintEventLabel(a,e,j,b,g.width,g.height,c),l=this;b=function(b,c){return l._onClickDurationEvent(m.elmt,c,a)};SimileAjax.DOM.registerEvent(m.elmt,"mousedown",b);SimileAjax.DOM.registerEvent(e.elmt,"mousedown",b);this._createHighlightDiv(d,m,c);this._eventIdToElmt[a.getID()]=m.elmt};
Timeline.DetailedEventPainter.prototype.paintImpreciseDurationEvent=function(a,b,c,d){this._timeline.getDocument();var e=a.getText(),g=a.getStart(),f=a.getLatestStart(),h=a.getEnd(),j=a.getEarliestEnd(),g=Math.round(this._band.dateToPixelOffset(g)),k=Math.round(this._band.dateToPixelOffset(f)),h=Math.round(this._band.dateToPixelOffset(h)),m=Math.round(this._band.dateToPixelOffset(j)),j=this._frc.computeSize(e),f=this._findFreeTrackForSolid(h),l=a.getColor(),l=null!=l?l:c.event.duration.color;this._paintEventTape(a,
f,g,h,c.event.duration.impreciseColor,c.event.duration.impreciseOpacity,b,c);var p=this._paintEventTape(a,f,k,m,l,100,b,c);this._getTrackData(f).solid=g;g=k+c.event.label.offsetFromLine;h=this._findFreeTrackForText(f,g+j.width,function(a){a.line=k-2});this._getTrackData(h).text=k-2;this._paintEventLine(a,k,f,h,b,c);b=Math.round(b.trackOffset+h*b.trackIncrement+b.trackHeight/2-j.height/2);var e=this._paintEventLabel(a,e,g,b,j.width,j.height,c),r=this;b=function(b,c){return r._onClickDurationEvent(p.elmt,
c,a)};SimileAjax.DOM.registerEvent(p.elmt,"mousedown",b);SimileAjax.DOM.registerEvent(e.elmt,"mousedown",b);this._createHighlightDiv(d,p,c);this._eventIdToElmt[a.getID()]=p.elmt};
Timeline.DetailedEventPainter.prototype._findFreeTrackForSolid=function(a,b){for(var c=0;;c++){if(c<this._lowerTracks.length){var d=this._lowerTracks[c];if(Math.min(d.solid,d.text)>a&&(!b||d.line>b))return c}else return this._lowerTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY}),c;if(c<this._upperTracks.length){if(d=this._upperTracks[c],Math.min(d.solid,d.text)>a&&(!b||d.line>b))return-1-c}else return this._upperTracks.push({solid:Number.POSITIVE_INFINITY,
text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY}),-1-c}};
Timeline.DetailedEventPainter.prototype._findFreeTrackForText=function(a,b,c){var d,e;0>a?(d=!0,a=-a,b=this._findFreeUpperTrackForText(a,b),e=-1-b):0<a?(d=!1,a+=1,e=b=this._findFreeLowerTrackForText(a,b)):(e=this._findFreeUpperTrackForText(0,b),b=this._findFreeLowerTrackForText(1,b),b-1<=e?(d=!1,a=1,e=b):(d=!0,a=0,b=e,e=-1-b));if(d){b==this._upperTracks.length&&this._upperTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY});for(d=a;d<b;d++)c(this._upperTracks[d])}else{b==
this._lowerTracks.length&&this._lowerTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY});for(d=a;d<b;d++)c(this._lowerTracks[d])}return e};Timeline.DetailedEventPainter.prototype._findFreeLowerTrackForText=function(a,b){for(;a<this._lowerTracks.length;a++){var c=this._lowerTracks[a];if(Math.min(c.solid,c.text)>=b)break}return a};
Timeline.DetailedEventPainter.prototype._findFreeUpperTrackForText=function(a,b){for(;a<this._upperTracks.length;a++){var c=this._upperTracks[a];if(Math.min(c.solid,c.text)>=b)break}return a};Timeline.DetailedEventPainter.prototype._getTrackData=function(a){return 0>a?this._upperTracks[-a-1]:this._lowerTracks[a]};
Timeline.DetailedEventPainter.prototype._paintEventLine=function(a,b,c,d,e,g){a=Math.round(e.trackOffset+c*e.trackIncrement+e.trackHeight/2);e=Math.round(Math.abs(d-c)*e.trackIncrement);var f="1px solid "+g.event.label.lineColor,h=this._timeline.getDocument().createElement("div");h.style.position="absolute";h.style.left=b+"px";h.style.width=g.event.label.offsetFromLine+"px";h.style.height=e+"px";c>d?(h.style.top=a-e+"px",h.style.borderTop=f):(h.style.top=a+"px",h.style.borderBottom=f);h.style.borderLeft=
f;this._lineLayer.appendChild(h)};
Timeline.DetailedEventPainter.prototype._paintEventIcon=function(a,b,c,d){var e=a.getIcon(),e=null!=e?e:d.icon;b=Math.round(d.trackOffset+b*d.trackIncrement+d.trackHeight/2-d.iconHeight/2);var e=SimileAjax.Graphics.createTranslucentImage(e),g=this._timeline.getDocument().createElement("div");g.style.position="absolute";g.style.left=c+"px";g.style.top=b+"px";g.appendChild(e);g.style.cursor="pointer";null!=a._title&&(g.title=a._title);this._eventLayer.appendChild(g);return{left:c,top:b,width:d.iconWidth,
height:d.iconHeight,elmt:g}};
Timeline.DetailedEventPainter.prototype._paintEventLabel=function(a,b,c,d,e,g,f){var h=this._timeline.getDocument(),j=h.createElement("div");j.style.position="absolute";j.style.left=c+"px";j.style.width=e+"px";j.style.top=d+"px";j.style.height=g+"px";j.style.backgroundColor=f.event.label.backgroundColor;SimileAjax.Graphics.setOpacity(j,f.event.label.backgroundOpacity);this._eventLayer.appendChild(j);f=h.createElement("div");f.style.position="absolute";f.style.left=c+"px";f.style.width=e+"px";f.style.top=
d+"px";f.innerHTML=b;f.style.cursor="pointer";null!=a._title&&(f.title=a._title);b=a.getTextColor();null==b&&(b=a.getColor());null!=b&&(f.style.color=b);this._eventLayer.appendChild(f);return{left:c,top:d,width:e,height:g,elmt:f}};
Timeline.DetailedEventPainter.prototype._paintEventTape=function(a,b,c,d,e,g,f,h){d-=c;h=h.event.tape.height;b=Math.round(f.trackOffset+b*f.trackIncrement+f.trackHeight/2-h/2);f=this._timeline.getDocument().createElement("div");f.style.position="absolute";f.style.left=c+"px";f.style.width=d+"px";f.style.top=b+"px";f.style.height=h+"px";f.style.backgroundColor=e;f.style.overflow="hidden";f.style.cursor="pointer";null!=a._title&&(f.title=a._title);SimileAjax.Graphics.setOpacity(f,g);this._eventLayer.appendChild(f);
return{left:c,top:b,width:d,height:h,elmt:f}};Timeline.DetailedEventPainter.prototype._createHighlightDiv=function(a,b,c){if(0<=a){var d=this._timeline.getDocument();c=c.event;a=c.highlightColors[Math.min(a,c.highlightColors.length-1)];d=d.createElement("div");d.style.position="absolute";d.style.overflow="hidden";d.style.left=b.left-2+"px";d.style.width=b.width+4+"px";d.style.top=b.top-2+"px";d.style.height=b.height+4+"px";d.style.background=a;this._highlightLayer.appendChild(d)}};
Timeline.DetailedEventPainter.prototype._onClickInstantEvent=function(a,b,c){var d=SimileAjax.DOM.getPageCoordinates(a);this._showBubble(d.left+Math.ceil(a.offsetWidth/2),d.top+Math.ceil(a.offsetHeight/2),c);this._fireOnSelect(c.getID());b.cancelBubble=!0;SimileAjax.DOM.cancelEvent(b);return!1};
Timeline.DetailedEventPainter.prototype._onClickDurationEvent=function(a,b,c){if("pageX"in b){a=b.pageX;var d=b.pageY}else d=SimileAjax.DOM.getPageCoordinates(a),a=b.offsetX+d.left,d=b.offsetY+d.top;this._showBubble(a,d,c);this._fireOnSelect(c.getID());b.cancelBubble=!0;SimileAjax.DOM.cancelEvent(b);return!1};
Timeline.DetailedEventPainter.prototype.showBubble=function(a){var b=this._eventIdToElmt[a.getID()];if(b){var c=SimileAjax.DOM.getPageCoordinates(b);this._showBubble(c.left+b.offsetWidth/2,c.top+b.offsetHeight/2,a)}};
Timeline.DetailedEventPainter.prototype._showBubble=function(a,b,c){var d=document.createElement("div"),e=this._params.theme.event.bubble;c.fillInfoBubble(d,this._params.theme,this._band.getLabeller());SimileAjax.WindowManager.cancelPopups();SimileAjax.Graphics.createBubbleForContentAndPoint(d,a,b,e.width,null,e.maxHeight)};Timeline.DetailedEventPainter.prototype._fireOnSelect=function(a){for(var b=0;b<this._onSelectListeners.length;b++)this._onSelectListeners[b](a)};
Timeline.OverviewEventPainter=function(a){this._params=a;this._onSelectListeners=[];this._highlightMatcher=this._filterMatcher=null};Timeline.OverviewEventPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._highlightLayer=this._eventLayer=null};Timeline.OverviewEventPainter.prototype.getType=function(){return"overview"};Timeline.OverviewEventPainter.prototype.addOnSelectListener=function(a){this._onSelectListeners.push(a)};
Timeline.OverviewEventPainter.prototype.removeOnSelectListener=function(a){for(var b=0;b<this._onSelectListeners.length;b++)if(this._onSelectListeners[b]==a){this._onSelectListeners.splice(b,1);break}};Timeline.OverviewEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher};Timeline.OverviewEventPainter.prototype.setFilterMatcher=function(a){this._filterMatcher=a};Timeline.OverviewEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher};
Timeline.OverviewEventPainter.prototype.setHighlightMatcher=function(a){this._highlightMatcher=a};
Timeline.OverviewEventPainter.prototype.paint=function(){var a=this._band.getEventSource();if(null!=a){this._prepareForPainting();for(var b=this._params.theme.event,b={trackOffset:b.overviewTrack.offset,trackHeight:b.overviewTrack.height,trackGap:b.overviewTrack.gap,trackIncrement:b.overviewTrack.height+b.overviewTrack.gap},c=this._band.getMinDate(),d=this._band.getMaxDate(),e=null!=this._filterMatcher?this._filterMatcher:function(){return!0},g=null!=this._highlightMatcher?this._highlightMatcher:
function(){return-1},a=a.getEventReverseIterator(c,d);a.hasNext();)c=a.next(),e(c)&&this.paintEvent(c,b,this._params.theme,g(c));this._highlightLayer.style.display="block";this._eventLayer.style.display="block";this._band.updateEventTrackInfo(this._tracks.length,b.trackIncrement)}};Timeline.OverviewEventPainter.prototype.softPaint=function(){};
Timeline.OverviewEventPainter.prototype._prepareForPainting=function(){var a=this._band;this._tracks=[];null!=this._highlightLayer&&a.removeLayerDiv(this._highlightLayer);this._highlightLayer=a.createLayerDiv(105,"timeline-band-highlights");this._highlightLayer.style.display="none";null!=this._eventLayer&&a.removeLayerDiv(this._eventLayer);this._eventLayer=a.createLayerDiv(110,"timeline-band-events");this._eventLayer.style.display="none"};
Timeline.OverviewEventPainter.prototype.paintEvent=function(a,b,c,d){a.isInstant()?this.paintInstantEvent(a,b,c,d):this.paintDurationEvent(a,b,c,d)};Timeline.OverviewEventPainter.prototype.paintInstantEvent=function(a,b,c,d){var e=a.getStart(),e=Math.round(this._band.dateToPixelOffset(e)),g=a.getColor(),g=a.getClassName()?null:null!=g?g:c.event.duration.color;a=this._paintEventTick(a,e,g,100,b,c);this._createHighlightDiv(d,a,c)};
Timeline.OverviewEventPainter.prototype.paintDurationEvent=function(a,b,c,d){for(var e=a.getLatestStart(),g=a.getEarliestEnd(),e=Math.round(this._band.dateToPixelOffset(e)),g=Math.round(this._band.dateToPixelOffset(g)),f=0;f<this._tracks.length&&!(g<this._tracks[f]);f++);this._tracks[f]=g;var h=a.getColor(),j=a.getClassName(),h=j?null:null!=h?h:c.event.duration.color;a=this._paintEventTape(a,f,e,g,h,100,b,c,j);this._createHighlightDiv(d,a,c)};
Timeline.OverviewEventPainter.prototype._paintEventTape=function(a,b,c,d,e,g,f,h,j){a=f.trackOffset+b*f.trackIncrement;d-=c;f=f.trackHeight;b=this._timeline.getDocument().createElement("div");b.className="timeline-small-event-tape";j&&(b.className+=" small-"+j);b.style.left=c+"px";b.style.width=d+"px";b.style.top=a+"px";b.style.height=f+"px";e&&(b.style.backgroundColor=e);100>g&&SimileAjax.Graphics.setOpacity(b,g);this._eventLayer.appendChild(b);return{left:c,top:a,width:d,height:f,elmt:b}};
Timeline.OverviewEventPainter.prototype._paintEventTick=function(a,b,c,d,e,g){c=g.event.overviewTrack.tickHeight;e=e.trackOffset-c;g=this._timeline.getDocument().createElement("div");g.className="timeline-small-event-icon";g.style.left=b+"px";g.style.top=e+"px";if(a=a.getClassName())g.className+=" small-"+a;100>d&&SimileAjax.Graphics.setOpacity(g,d);this._eventLayer.appendChild(g);return{left:b,top:e,width:1,height:c,elmt:g}};
Timeline.OverviewEventPainter.prototype._createHighlightDiv=function(a,b,c){if(0<=a){var d=this._timeline.getDocument();c=c.event;a=c.highlightColors[Math.min(a,c.highlightColors.length-1)];d=d.createElement("div");d.style.position="absolute";d.style.overflow="hidden";d.style.left=b.left-1+"px";d.style.width=b.width+2+"px";d.style.top=b.top-1+"px";d.style.height=b.height+2+"px";d.style.background=a;this._highlightLayer.appendChild(d)}};Timeline.OverviewEventPainter.prototype.showBubble=function(){};
Timeline.CompactEventPainter=function(a){this._params=a;this._onSelectListeners=[];this._frc=this._highlightMatcher=this._filterMatcher=null;this._eventIdToElmt={}};Timeline.CompactEventPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._eventIdToElmt=this._highlightLayer=this._lineLayer=this._eventLayer=this._backLayer=null};Timeline.CompactEventPainter.prototype.addOnSelectListener=function(a){this._onSelectListeners.push(a)};
Timeline.CompactEventPainter.prototype.removeOnSelectListener=function(a){for(var b=0;b<this._onSelectListeners.length;b++)if(this._onSelectListeners[b]==a){this._onSelectListeners.splice(b,1);break}};Timeline.CompactEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher};Timeline.CompactEventPainter.prototype.setFilterMatcher=function(a){this._filterMatcher=a};Timeline.CompactEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher};
Timeline.CompactEventPainter.prototype.setHighlightMatcher=function(a){this._highlightMatcher=a};
Timeline.CompactEventPainter.prototype.paint=function(){var a=this._band.getEventSource();if(null!=a){this._eventIdToElmt={};this._prepareForPainting();var b=this._params.theme,c=b.event,b={trackOffset:"trackOffset"in this._params?this._params.trackOffset:10,trackHeight:"trackHeight"in this._params?this._params.trackHeight:10,tapeHeight:b.event.tape.height,tapeBottomMargin:"tapeBottomMargin"in this._params?this._params.tapeBottomMargin:2,labelBottomMargin:"labelBottomMargin"in this._params?this._params.labelBottomMargin:
5,labelRightMargin:"labelRightMargin"in this._params?this._params.labelRightMargin:5,defaultIcon:c.instant.icon,defaultIconWidth:c.instant.iconWidth,defaultIconHeight:c.instant.iconHeight,customIconWidth:"iconWidth"in this._params?this._params.iconWidth:c.instant.iconWidth,customIconHeight:"iconHeight"in this._params?this._params.iconHeight:c.instant.iconHeight,iconLabelGap:"iconLabelGap"in this._params?this._params.iconLabelGap:2,iconBottomMargin:"iconBottomMargin"in this._params?this._params.iconBottomMargin:
2};"compositeIcon"in this._params?(b.compositeIcon=this._params.compositeIcon,b.compositeIconWidth=this._params.compositeIconWidth||b.customIconWidth,b.compositeIconHeight=this._params.compositeIconHeight||b.customIconHeight):(b.compositeIcon=b.defaultIcon,b.compositeIconWidth=b.defaultIconWidth,b.compositeIconHeight=b.defaultIconHeight);b.defaultStackIcon="icon"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.icon:b.defaultIcon;b.defaultStackIconWidth=
"iconWidth"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.iconWidth:b.defaultIconWidth;b.defaultStackIconHeight="iconHeight"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.iconHeight:b.defaultIconHeight;var d=this._band.getMinDate(),e=this._band.getMaxDate(),g=null!=this._filterMatcher?this._filterMatcher:function(){return!0},c=null!=this._highlightMatcher?this._highlightMatcher:function(){return-1},
e=a.getEventIterator(d,e),a="stackConcurrentPreciseInstantEvents"in this._params&&"object"==typeof this._params.stackConcurrentPreciseInstantEvents;if("collapseConcurrentPreciseInstantEvents"in this._params&&this._params.collapseConcurrentPreciseInstantEvents||a){for(var d=[],f=null;e.hasNext();){var h=e.next();g(h)&&(!h.isInstant()||h.isImprecise()?this.paintEvent(h,b,this._params.theme,c(h)):null!=f&&f.getStart().getTime()==h.getStart().getTime()?d[d.length-1].push(h):(d.push([h]),f=h))}for(g=0;g<
d.length;g++)if(e=d[g],1==e.length)this.paintEvent(e[0],b,this._params.theme,c(h));else{for(var f=-1,j=0;0>f&&j<e.length;j++)f=c(e[j]);a?this.paintStackedPreciseInstantEvents(e,b,this._params.theme,f):this.paintCompositePreciseInstantEvents(e,b,this._params.theme,f)}}else for(;e.hasNext();)h=e.next(),g(h)&&this.paintEvent(h,b,this._params.theme,c(h));this._highlightLayer.style.display="block";this._lineLayer.style.display="block";this._eventLayer.style.display="block"}};
Timeline.CompactEventPainter.prototype.softPaint=function(){};
Timeline.CompactEventPainter.prototype._prepareForPainting=function(){var a=this._band;if(null==this._backLayer){this._backLayer=this._band.createLayerDiv(0,"timeline-band-events");this._backLayer.style.visibility="hidden";var b=document.createElement("span");b.className="timeline-event-label";this._backLayer.appendChild(b);this._frc=SimileAjax.Graphics.getFontRenderingContext(b)}this._frc.update();this._tracks=[];null!=this._highlightLayer&&a.removeLayerDiv(this._highlightLayer);this._highlightLayer=
a.createLayerDiv(105,"timeline-band-highlights");this._highlightLayer.style.display="none";null!=this._lineLayer&&a.removeLayerDiv(this._lineLayer);this._lineLayer=a.createLayerDiv(110,"timeline-band-lines");this._lineLayer.style.display="none";null!=this._eventLayer&&a.removeLayerDiv(this._eventLayer);this._eventLayer=a.createLayerDiv(115,"timeline-band-events");this._eventLayer.style.display="none"};
Timeline.CompactEventPainter.prototype.paintEvent=function(a,b,c,d){a.isInstant()?this.paintInstantEvent(a,b,c,d):this.paintDurationEvent(a,b,c,d)};Timeline.CompactEventPainter.prototype.paintInstantEvent=function(a,b,c,d){a.isImprecise()?this.paintImpreciseInstantEvent(a,b,c,d):this.paintPreciseInstantEvent(a,b,c,d)};Timeline.CompactEventPainter.prototype.paintDurationEvent=function(a,b,c,d){a.isImprecise()?this.paintImpreciseDurationEvent(a,b,c,d):this.paintPreciseDurationEvent(a,b,c,d)};
Timeline.CompactEventPainter.prototype.paintPreciseInstantEvent=function(a,b,c,d){var e={tooltip:a.getProperty("tooltip")||a.getText()},g={url:a.getIcon()};null==g.url?(g.url=b.defaultIcon,g.width=b.defaultIconWidth,g.height=b.defaultIconHeight,g.className="timeline-event-icon-default"):(g.width=a.getProperty("iconWidth")||b.customIconWidth,g.height=a.getProperty("iconHeight")||b.customIconHeight);var f={text:a.getText(),color:a.getTextColor()||a.getColor(),className:a.getClassName()},h=this.paintTapeIconLabel(a.getStart(),
e,null,g,f,b,c,d),j=this;b=function(b,c){return j._onClickInstantEvent(h.iconElmtData.elmt,c,a)};SimileAjax.DOM.registerEvent(h.iconElmtData.elmt,"mousedown",b);SimileAjax.DOM.registerEvent(h.labelElmtData.elmt,"mousedown",b);this._eventIdToElmt[a.getID()]=h.iconElmtData.elmt};
Timeline.CompactEventPainter.prototype.paintCompositePreciseInstantEvents=function(a,b,c,d){for(var e=a[0],g=[],f=0;f<a.length;f++)g.push(a[f].getProperty("tooltip")||a[f].getText());var g={tooltip:g.join("; ")},f={url:b.compositeIcon,width:b.compositeIconWidth,height:b.compositeIconHeight,className:"timeline-event-icon-composite"},h={text:String.substitute(this._params.compositeEventLabelTemplate,[a.length])},j=this.paintTapeIconLabel(e.getStart(),g,null,f,h,b,c,d),k=this;b=function(b,c){return k._onClickMultiplePreciseInstantEvent(j.iconElmtData.elmt,
c,a)};SimileAjax.DOM.registerEvent(j.iconElmtData.elmt,"mousedown",b);SimileAjax.DOM.registerEvent(j.labelElmtData.elmt,"mousedown",b);for(f=0;f<a.length;f++)this._eventIdToElmt[a[f].getID()]=j.iconElmtData.elmt};
Timeline.CompactEventPainter.prototype.paintStackedPreciseInstantEvents=function(a,b,c){var d="limit"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.limit:10,e="moreMessageTemplate"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.moreMessageTemplate:"%0 More Events",g=d<=a.length-2,f=this._band,h=function(a){var c={url:a.getIcon()};null==c.url?(c.url=b.defaultStackIcon,c.width=b.defaultStackIconWidth,
c.height=b.defaultStackIconHeight,c.className="timeline-event-icon-stack timeline-event-icon-default"):(c.width=a.getProperty("iconWidth")||b.customIconWidth,c.height=a.getProperty("iconHeight")||b.customIconHeight,c.className="timeline-event-icon-stack");return c},j=h(a[0]),k=0,m=0,l=0,p=0,r=[],n=0;for(;n<a.length&&(!g||n<d);n++){var q=a[n],s=q.getText(),q=h(q),t=this._frc.computeSize(s),s={text:s,iconData:q,labelSize:t,iconLeft:j.width+5*n-q.width};s.labelLeft=j.width+5*n+b.iconLabelGap;s.top=l;
r.push(s);k=Math.min(k,s.iconLeft);l+=t.height;m=Math.max(m,s.labelLeft+t.width);p=Math.max(p,s.top+q.height)}if(g)var y=String.substitute(e,[a.length-d]),x=this._frc.computeSize(y),C=j.width+5*(d-1)+b.iconLabelGap,E=l,l=l+x.height,m=Math.max(m,C+x.width);var m=m+b.labelRightMargin,l=l+b.labelBottomMargin,p=p+b.iconBottomMargin,v,n=a[0].getStart();v=Math.round(f.dateToPixelOffset(n));f=[];e=Math.ceil(Math.max(p,l)/b.trackHeight);j=j.width+5*(a.length-1);for(n=0;n<e;n++)f.push({start:k,end:j});k=Math.ceil(l/
b.trackHeight);for(n=0;n<k;n++)l=f[n],l.end=Math.max(l.end,m);var z=this._fitTracks(v,f)*b.trackHeight+b.trackOffset,u=this._timeline.getDocument().createElement("div");u.className="timeline-event-icon-stack";u.style.position="absolute";u.style.overflow="visible";u.style.left=v+"px";u.style.top=z+"px";u.style.width=j+"px";u.style.height=p+"px";u.innerHTML="<div style='position: relative'></div>";this._eventLayer.appendChild(u);var w=this,D=function(){try{for(var a=parseInt(this.getAttribute("index")),
b=u.firstChild.childNodes,c=0;c<b.length;c++)b[c].style.zIndex=c==a?b.length:b.length-c}catch(d){}},m=function(b){var d=r[b],f=a[b],e=f.getProperty("tooltip")||f.getText(),g=w._paintEventLabel({tooltip:e},{text:d.text},v+d.labelLeft,z+d.top,d.labelSize.width,d.labelSize.height,c);g.elmt.setAttribute("index",b);g.elmt.onmouseover=D;var h=SimileAjax.Graphics.createTranslucentImage(d.iconData.url),e=w._timeline.getDocument().createElement("div");e.className="timeline-event-icon"+("className"in d.iconData?
" "+d.iconData.className:"");e.style.left=d.iconLeft+"px";e.style.top=d.top+"px";e.style.zIndex=r.length-b;e.appendChild(h);e.setAttribute("index",b);e.onmouseover=D;u.firstChild.appendChild(e);b=function(a,b){return w._onClickInstantEvent(g.elmt,b,f)};SimileAjax.DOM.registerEvent(e,"mousedown",b);SimileAjax.DOM.registerEvent(g.elmt,"mousedown",b);w._eventIdToElmt[f.getID()]=e},n=0;for(;n<r.length;n++)m(n);if(g){var A=a.slice(d),B=this._paintEventLabel({tooltip:y},{text:y},v+C,z+E,x.width,x.height,
c);SimileAjax.DOM.registerEvent(B.elmt,"mousedown",function(a,b){return w._onClickMultiplePreciseInstantEvent(B.elmt,b,A)});for(n=0;n<A.length;n++)this._eventIdToElmt[A[n].getID()]=B.elmt}};
Timeline.CompactEventPainter.prototype.paintImpreciseInstantEvent=function(a,b,c,d){var e={tooltip:a.getProperty("tooltip")||a.getText()},g={start:a.getStart(),end:a.getEnd(),latestStart:a.getLatestStart(),earliestEnd:a.getEarliestEnd(),isInstant:!0},f={url:a.getIcon()};null==f.url?f=null:(f.width=a.getProperty("iconWidth")||b.customIconWidth,f.height=a.getProperty("iconHeight")||b.customIconHeight);var h={text:a.getText(),color:a.getTextColor()||a.getColor(),className:a.getClassName()},j=this.paintTapeIconLabel(a.getStart(),
e,g,f,h,b,c,d),k=this;b=null!=f?function(b,c){return k._onClickInstantEvent(j.iconElmtData.elmt,c,a)}:function(b,c){return k._onClickInstantEvent(j.labelElmtData.elmt,c,a)};SimileAjax.DOM.registerEvent(j.labelElmtData.elmt,"mousedown",b);SimileAjax.DOM.registerEvent(j.impreciseTapeElmtData.elmt,"mousedown",b);null!=f?(SimileAjax.DOM.registerEvent(j.iconElmtData.elmt,"mousedown",b),this._eventIdToElmt[a.getID()]=j.iconElmtData.elmt):this._eventIdToElmt[a.getID()]=j.labelElmtData.elmt};
Timeline.CompactEventPainter.prototype.paintPreciseDurationEvent=function(a,b,c,d){var e={tooltip:a.getProperty("tooltip")||a.getText()},g={start:a.getStart(),end:a.getEnd(),isInstant:!1},f={url:a.getIcon()};null==f.url?f=null:(f.width=a.getProperty("iconWidth")||b.customIconWidth,f.height=a.getProperty("iconHeight")||b.customIconHeight);var h={text:a.getText(),color:a.getTextColor()||a.getColor(),className:a.getClassName()},j=this.paintTapeIconLabel(a.getLatestStart(),e,g,f,h,b,c,d),k=this;b=null!=
f?function(b,c){return k._onClickInstantEvent(j.iconElmtData.elmt,c,a)}:function(b,c){return k._onClickInstantEvent(j.labelElmtData.elmt,c,a)};SimileAjax.DOM.registerEvent(j.labelElmtData.elmt,"mousedown",b);SimileAjax.DOM.registerEvent(j.tapeElmtData.elmt,"mousedown",b);null!=f?(SimileAjax.DOM.registerEvent(j.iconElmtData.elmt,"mousedown",b),this._eventIdToElmt[a.getID()]=j.iconElmtData.elmt):this._eventIdToElmt[a.getID()]=j.labelElmtData.elmt};
Timeline.CompactEventPainter.prototype.paintImpreciseDurationEvent=function(a,b,c,d){var e={tooltip:a.getProperty("tooltip")||a.getText()},g={start:a.getStart(),end:a.getEnd(),latestStart:a.getLatestStart(),earliestEnd:a.getEarliestEnd(),isInstant:!1},f={url:a.getIcon()};null==f.url?f=null:(f.width=a.getProperty("iconWidth")||b.customIconWidth,f.height=a.getProperty("iconHeight")||b.customIconHeight);var h={text:a.getText(),color:a.getTextColor()||a.getColor(),className:a.getClassName()},j=this.paintTapeIconLabel(a.getLatestStart(),
e,g,f,h,b,c,d),k=this;b=null!=f?function(b,c){return k._onClickInstantEvent(j.iconElmtData.elmt,c,a)}:function(b,c){return k._onClickInstantEvent(j.labelElmtData.elmt,c,a)};SimileAjax.DOM.registerEvent(j.labelElmtData.elmt,"mousedown",b);SimileAjax.DOM.registerEvent(j.tapeElmtData.elmt,"mousedown",b);null!=f?(SimileAjax.DOM.registerEvent(j.iconElmtData.elmt,"mousedown",b),this._eventIdToElmt[a.getID()]=j.iconElmtData.elmt):this._eventIdToElmt[a.getID()]=j.labelElmtData.elmt};
Timeline.CompactEventPainter.prototype.paintTapeIconLabel=function(a,b,c,d,e,g,f){var h=this._band,j=function(a){return Math.round(h.dateToPixelOffset(a))};a=j(a);var k=[],m=0,l=0,p=0;if(null!=c){for(var m=g.tapeHeight+g.tapeBottomMargin,l=Math.ceil(g.tapeHeight/g.trackHeight),r=j(c.end)-a,n=j(c.start)-a,q=0;q<l;q++)k.push({start:n,end:r});p=g.trackHeight-m%g.tapeHeight}n=r=0;if(null!=d){"iconAlign"in d&&"center"==d.iconAlign&&(r=-Math.floor(d.width/2));n=r+d.width+g.iconLabelGap;0<l&&(k[l-1].end=
Math.max(k[l-1].end,n));for(q=d.height+g.iconBottomMargin+p;0<q;)k.push({start:r,end:n}),q-=g.trackHeight}var q=this._frc.computeSize(e.text),p=q.height+g.labelBottomMargin+p,s=n+q.width+g.labelRightMargin;0<l&&(k[l-1].end=Math.max(k[l-1].end,s));for(var t=0;0<p;t++)l+t<k.length?k[l+t].end=s:k.push({start:0,end:s}),p-=g.trackHeight;k=this._fitTracks(a,k)*g.trackHeight+g.trackOffset;l={};l.labelElmtData=this._paintEventLabel(b,e,a+n,k+m,q.width,q.height,f);if(null!=c){if("latestStart"in c||"earliestEnd"in
c)l.impreciseTapeElmtData=this._paintEventTape(b,c,g.tapeHeight,k,j(c.start),j(c.end),f.event.duration.impreciseColor,f.event.duration.impreciseOpacity,g,f);!c.isInstant&&("start"in c&&"end"in c)&&(l.tapeElmtData=this._paintEventTape(b,c,g.tapeHeight,k,a,j("earliestEnd"in c?c.earliestEnd:c.end),c.color,100,g,f))}null!=d&&(l.iconElmtData=this._paintEventIcon(b,d,k+m,a+r,g,f));return l};
Timeline.CompactEventPainter.prototype._fitTracks=function(a,b){var c;for(c=0;c<this._tracks.length;c++){for(var d=!0,e=0;e<b.length&&c+e<this._tracks.length;e++)if(a+b[e].start<this._tracks[c+e]){d=!1;break}if(d)break}for(d=0;d<b.length;d++)this._tracks[c+d]=a+b[d].end;return c};
Timeline.CompactEventPainter.prototype._paintEventIcon=function(a,b,c,d,e){var g=SimileAjax.Graphics.createTranslucentImage(b.url),f=this._timeline.getDocument().createElement("div");f.className="timeline-event-icon"+("className"in b?" "+b.className:"");f.style.left=d+"px";f.style.top=c+"px";f.appendChild(g);"tooltip"in a&&"string"==typeof a.tooltip&&(f.title=a.tooltip);this._eventLayer.appendChild(f);return{left:d,top:c,width:e.iconWidth,height:e.iconHeight,elmt:f}};
Timeline.CompactEventPainter.prototype._paintEventLabel=function(a,b,c,d,e,g){var f=this._timeline.getDocument().createElement("div");f.className="timeline-event-label";f.style.left=c+"px";f.style.width=e+1+"px";f.style.top=d+"px";f.innerHTML=b.text;"tooltip"in a&&"string"==typeof a.tooltip&&(f.title=a.tooltip);"color"in b&&"string"==typeof b.color&&(f.style.color=b.color);"className"in b&&"string"==typeof b.className&&(f.className+=" "+b.className);this._eventLayer.appendChild(f);return{left:c,top:d,
width:e,height:g,elmt:f}};
Timeline.CompactEventPainter.prototype._paintEventTape=function(a,b,c,d,e,g,f,h){g-=e;var j=this._timeline.getDocument().createElement("div");j.className="timeline-event-tape";j.style.left=e+"px";j.style.top=d+"px";j.style.width=g+"px";j.style.height=c+"px";"tooltip"in a&&"string"==typeof a.tooltip&&(j.title=a.tooltip);null!=f&&"string"==typeof b.color&&(j.style.backgroundColor=f);"backgroundImage"in b&&"string"==typeof b.backgroundImage&&(j.style.backgroundImage="url("+backgroundImage+")",j.style.backgroundRepeat=
"backgroundRepeat"in b&&"string"==typeof b.backgroundRepeat?b.backgroundRepeat:"repeat");SimileAjax.Graphics.setOpacity(j,h);"className"in b&&"string"==typeof b.className&&(j.className+=" "+b.className);this._eventLayer.appendChild(j);return{left:e,top:d,width:g,height:c,elmt:j}};
Timeline.CompactEventPainter.prototype._createHighlightDiv=function(a,b,c){if(0<=a){var d=this._timeline.getDocument();Math.min(a,c.event.highlightColors.length-1);a=d.createElement("div");a.style.position="absolute";a.style.overflow="hidden";a.style.left=b.left-2+"px";a.style.width=b.width+4+"px";a.style.top=b.top-2+"px";a.style.height=b.height+4+"px";this._highlightLayer.appendChild(a)}};
Timeline.CompactEventPainter.prototype._onClickMultiplePreciseInstantEvent=function(a,b,c){var d=SimileAjax.DOM.getPageCoordinates(a);this._showBubble(d.left+Math.ceil(a.offsetWidth/2),d.top+Math.ceil(a.offsetHeight/2),c);a=[];for(d=0;d<c.length;d++)a.push(c[d].getID());this._fireOnSelect(a);b.cancelBubble=!0;SimileAjax.DOM.cancelEvent(b);return!1};
Timeline.CompactEventPainter.prototype._onClickInstantEvent=function(a,b,c){var d=SimileAjax.DOM.getPageCoordinates(a);this._showBubble(d.left+Math.ceil(a.offsetWidth/2),d.top+Math.ceil(a.offsetHeight/2),[c]);this._fireOnSelect([c.getID()]);b.cancelBubble=!0;SimileAjax.DOM.cancelEvent(b);return!1};
Timeline.CompactEventPainter.prototype._onClickDurationEvent=function(a,b,c){if("pageX"in b){a=b.pageX;var d=b.pageY}else d=SimileAjax.DOM.getPageCoordinates(a),a=b.offsetX+d.left,d=b.offsetY+d.top;this._showBubble(a,d,[c]);this._fireOnSelect([c.getID()]);b.cancelBubble=!0;SimileAjax.DOM.cancelEvent(b);return!1};
Timeline.CompactEventPainter.prototype.showBubble=function(a){var b=this._eventIdToElmt[a.getID()];if(b){var c=SimileAjax.DOM.getPageCoordinates(b);this._showBubble(c.left+b.offsetWidth/2,c.top+b.offsetHeight/2,[a])}};
Timeline.CompactEventPainter.prototype._showBubble=function(a,b,c){var d=document.createElement("div");c="fillInfoBubble"in c?[c]:c;for(var e=0;e<c.length;e++){var g=document.createElement("div");d.appendChild(g);c[e].fillInfoBubble(g,this._params.theme,this._band.getLabeller())}SimileAjax.WindowManager.cancelPopups();SimileAjax.Graphics.createBubbleForContentAndPoint(d,a,b,this._params.theme.event.bubble.width)};Timeline.CompactEventPainter.prototype._fireOnSelect=function(a){for(var b=0;b<this._onSelectListeners.length;b++)this._onSelectListeners[b](a)};
Timeline.SpanHighlightDecorator=function(a){this._unit=null!=a.unit?a.unit:SimileAjax.NativeDateUnit;this._startDate="string"==typeof a.startDate?this._unit.parseFromObject(a.startDate):a.startDate;this._endDate="string"==typeof a.endDate?this._unit.parseFromObject(a.endDate):a.endDate;this._startLabel=null!=a.startLabel?a.startLabel:"";this._endLabel=null!=a.endLabel?a.endLabel:"";this._color=a.color;this._cssClass=null!=a.cssClass?a.cssClass:null;this._opacity=null!=a.opacity?a.opacity:100;this._zIndex=
null!=a.inFront&&a.inFront?113:10};Timeline.SpanHighlightDecorator.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._layerDiv=null};
Timeline.SpanHighlightDecorator.prototype.paint=function(){null!=this._layerDiv&&this._band.removeLayerDiv(this._layerDiv);this._layerDiv=this._band.createLayerDiv(this._zIndex);this._layerDiv.setAttribute("name","span-highlight-decorator");this._layerDiv.style.display="none";var a=this._band.getMinDate(),b=this._band.getMaxDate();if(0>this._unit.compare(this._startDate,b)&&0<this._unit.compare(this._endDate,a)){var a=this._unit.later(a,this._startDate),b=this._unit.earlier(b,this._endDate),a=this._band.dateToPixelOffset(a),
b=this._band.dateToPixelOffset(b),c=this._timeline.getDocument(),d=function(){var a=c.createElement("table");a.insertRow(0).insertCell(0);return a},e=c.createElement("div");e.className="timeline-highlight-decorator";this._cssClass&&(e.className+=" "+this._cssClass);null!=this._color&&(e.style.backgroundColor=this._color);100>this._opacity&&SimileAjax.Graphics.setOpacity(e,this._opacity);this._layerDiv.appendChild(e);var g=d();g.className="timeline-highlight-label timeline-highlight-label-start";var f=
g.rows[0].cells[0];f.innerHTML=this._startLabel;this._cssClass&&(f.className="label_"+this._cssClass);this._layerDiv.appendChild(g);d=d();d.className="timeline-highlight-label timeline-highlight-label-end";f=d.rows[0].cells[0];f.innerHTML=this._endLabel;this._cssClass&&(f.className="label_"+this._cssClass);this._layerDiv.appendChild(d);this._timeline.isHorizontal()?(e.style.left=a+"px",e.style.width=b-a+"px",g.style.right=this._band.getTotalViewLength()-a+"px",g.style.width=this._startLabel.length+
"em",d.style.left=b+"px",d.style.width=this._endLabel.length+"em"):(e.style.top=a+"px",e.style.height=b-a+"px",g.style.bottom=a+"px",g.style.height="1.5px",d.style.top=b+"px",d.style.height="1.5px")}this._layerDiv.style.display="block"};Timeline.SpanHighlightDecorator.prototype.softPaint=function(){};
Timeline.PointHighlightDecorator=function(a){this._unit=null!=a.unit?a.unit:SimileAjax.NativeDateUnit;this._date="string"==typeof a.date?this._unit.parseFromObject(a.date):a.date;this._width=null!=a.width?a.width:10;this._color=a.color;this._cssClass=null!=a.cssClass?a.cssClass:"";this._opacity=null!=a.opacity?a.opacity:100};Timeline.PointHighlightDecorator.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._layerDiv=null};
Timeline.PointHighlightDecorator.prototype.paint=function(){null!=this._layerDiv&&this._band.removeLayerDiv(this._layerDiv);this._layerDiv=this._band.createLayerDiv(10);this._layerDiv.setAttribute("name","span-highlight-decorator");this._layerDiv.style.display="none";var a=this._band.getMinDate(),b=this._band.getMaxDate();0>this._unit.compare(this._date,b)&&0<this._unit.compare(this._date,a)&&(a=this._band.dateToPixelOffset(this._date)-Math.round(this._width/2),b=this._timeline.getDocument().createElement("div"),
b.className="timeline-highlight-point-decorator",b.className+=" "+this._cssClass,null!=this._color&&(b.style.backgroundColor=this._color),100>this._opacity&&SimileAjax.Graphics.setOpacity(b,this._opacity),this._layerDiv.appendChild(b),this._timeline.isHorizontal()?(b.style.left=a+"px",b.style.width=this._width):(b.style.top=a+"px",b.style.height=this._width));this._layerDiv.style.display="block"};Timeline.PointHighlightDecorator.prototype.softPaint=function(){};Timeline.NativeDateUnit={};
Timeline.NativeDateUnit.createLabeller=function(a,b){return new Timeline.GregorianDateLabeller(a,b)};Timeline.NativeDateUnit.makeDefaultValue=function(){return new Date};Timeline.NativeDateUnit.cloneValue=function(a){return new Date(a.getTime())};Timeline.NativeDateUnit.getParser=function(a){"string"==typeof a&&(a=a.toLowerCase());return"iso8601"==a||"iso 8601"==a?Timeline.DateTime.parseIso8601DateTime:Timeline.DateTime.parseGregorianDateTime};Timeline.NativeDateUnit.parseFromObject=function(a){return Timeline.DateTime.parseGregorianDateTime(a)};
Timeline.NativeDateUnit.toNumber=function(a){return a.getTime()};Timeline.NativeDateUnit.fromNumber=function(a){return new Date(a)};Timeline.NativeDateUnit.compare=function(a,b){var c,d;c="object"==typeof a?a.getTime():Number(a);d="object"==typeof b?b.getTime():Number(b);return c-d};Timeline.NativeDateUnit.earlier=function(a,b){return 0>Timeline.NativeDateUnit.compare(a,b)?a:b};Timeline.NativeDateUnit.later=function(a,b){return 0<Timeline.NativeDateUnit.compare(a,b)?a:b};
Timeline.NativeDateUnit.change=function(a,b){return new Date(a.getTime()+b)};
